<include file="public/header" title="申请售后服务" body="g4"/>
<include file="public/header_nav" title="申请售后服务" href="javascript:history.back(-1);"/>
<style>
	.radio .che span {
		width: 13.9rem;
	}
	.signup-find, .radio {
		width: 100%;
	}
	.paycloseto {
		width: auto;
	}
</style>
		<div class="attention-shoppay applyafter">
			<div class="orderlistshpop tuharecha mabo20 p">
				<div class="maleri30">
					<div class="sc_list se_sclist paycloseto">
						<div class="shopimg fl">
							<img src="{$goods.goods_id|goods_thum_images=100,100,$goods.item_id}">
						</div>
						<div class="deleshow fr">
							<div class="deletes">
								<a class="daaloe">{$goods.goods_name}</a>
							</div>
							<div class="qxatten">
								<div class="weight">
									<p><span>价格：</span><span><em>￥</em>{$goods.goods_price}</span></p>
									<p><span>数量：</span><span>x{$goods.goods_num}</span></p>
									<a class="closeannten" href="javascript:void(0)">联系卖家</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<form name="return_form" id="return_form" autocomplete="off" method="post" enctype="multipart/form-data">
		<div class="seravetype">
			<div class="maleri30">
				<p>服务类型</p>
				<div class="fuwxbo">
					<a href="javascript:void(0);" class="<if condition='$return_goods[type] eq 0'>red</if>" tvalue="0" onclick="$('#rtype').val(0)">仅退款</a>
					<a href="javascript:void(0);" class="<if condition='$return_goods[type] eq 1'>red</if>" tvalue="1" onclick="$('#rtype').val(1)">退货退款</a>
					<a href="javascript:void(0);" class="<if condition='$return_goods[type] eq 2'>red</if>" tvalue="2" onclick="$('#rtype').val(2)">换货</a>
					<a href="javascript:void(0);" class="<if condition='$return_goods[type] eq 3'>red</if>" tvalue="3" onclick="$('#rtype').val(3)">维修</a>
					<input type="hidden" name="type" value="{$return_goods[type]|default=0}" id="rtype">
					<input type="hidden" value="{$goods.goods_num}" id="buynum">
				</div>
			</div>
		</div>
		<div class="seravetype ma-to-20">
			<div class="maleri30">
				<p>申请数量</p>
				<div class="plus">
					<span class="mp_minous" onclick="altergoodsnum(-1)">-</span>
					<span class="mp_mp">
                        <input type="tel" name="goods_num" id="number" value="{$goods.goods_num}" min="{$goods['goods_num']}" max="{$goods.goods_num}" onblur="altergoodsnum(0)">
                    </span>
					<span class="mp_plus" onclick="altergoodsnum(+1)">+</span>
				</div>
			</div>
		</div>
        <div class="seravetype ma-to-20 account">
            <div class="maleri30">
                <p>提交原因 <span class="ifhaeu" id="account">注意保持商品的完好，建议您先与卖家沟通</span></p>
            </div>
        </div>
		<div class="seravetype ma-to-20">
			<div class="maleri30">
				<p>货物状态</p>
				<div class="inspectrepot p">
					<div class="radio clr_unfinished">
						<span class="che <if condition='$return_goods[is_receive] eq 0'>check_t</if>" rel="0" onclick="cut_deliver(this)">
							<i></i>
							<span>未收到货</span>
						</span>
					</div>
					<div class="radio clr_achieve">
						<span class="che  <if condition='$return_goods[is_receive] eq 1'>check_t</if>" rel="1" onclick="cut_deliver(this)">
							<i></i>
							<span>已收到货</span>
						</span>
					</div>
					<input type="hidden" name="is_receive" id="is_receive" value="0">
				</div>
			</div>
		</div>
		<div class="customer-messa apply-afterserve ma-to-20">
			<div class="maleri30">
				<p><em class="red">*</em> 问题描述</p>
				<textarea class="tapassa" onkeyup="checkfilltextarea('.tapassa','500')" name="describe" id="describe" rows="" cols="" placeholder="请你在此描述详细问题">{$return_goods.describe}</textarea>
				<span class="xianzd"><em id="zero">500</em>/500</span>
			</div>
		</div>
		<div class="seravetype ma-to-20">
			<div class="maleri30">
				<p>上传照片</p>
				<ul>
				<label>
                    <li class="file">
                        <div class="shcph" id="fileList0">
                            <img src="__STATIC__/images/scph.png">
                        </div>
                        <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,0)" style="display:none">
                    </li>
                </label>
                <label>
                    <li class="file">
                        <div class="shcph" id="fileList1">
                            <img src="__STATIC__/images/scph.png">
                        </div>
                        <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,1)" style="display:none">
                    </li>
                </label>
                <label>
                    <li class="file">
                        <div class="shcph" id="fileList2">
                            <img src="__STATIC__/images/scph.png">
                        </div>
                        <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,2)" style="display:none">
                    </li>
                </label>
                <label>
                    <li class="file">
                        <div class="shcph" id="fileList3">
                            <img src="__STATIC__/images/scph.png">
                        </div>
                        <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,3)" style="display:none">
                    </li>
                </label>
                <label>
                    <li class="file">
                        <div class="shcph" id="fileList4">
                            <img src="__STATIC__/images/scph.png">
                        </div>
                        <input  type="file" accept="image/*" name="return_imgs[]"  onchange="handleFiles(this,4)" style="display:none">
                    </li>
                </label>
				</ul>
				<p class="ifhaeu">为帮助我们更好的解决问题，请上传照片。最多5张，每张不超过5M，支持JPG、BMP、PNG</p>
			</div>
		</div>
		<div class="shprutba ma-to-20">
			<div class="maleri30">
				<p class="tutif">商品退回方式</p>
				<div class="kzthuic">
					<a class="kaid" href="javascript:void(0);">快递至第三方卖家</a>
				</div>
			</div>
		</div>
		<div class="intrudjs">
			<div class="maleri30">
				<p>商品返回地址将在服务审核通过后以短信形式告知，或在查看返修/退换货记录中查询，商城不收取快递附加费用</p>
			</div>
		</div>
		<div class="zblikbo p ma-to-20">
			<div class="qhsxix">
				<div class="myorder p">
					<div class="order">
						<div class="fl">
							<span>联系人：</span>
						</div>
						<div class="fl">
							<p class="addretu">{$order.consignee}</p>
						</div>
					</div>
				</div>
				<div class="myorder p">
					<div class="order">
						<div class="fl">
							<span>联系电话：</span>
						</div>
						<div class="fl">
							<p class="addretu">{$order.mobile}</p>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<div class="zblikbo p" style="display:none;">
			<div class="qhsxix">
				<div class="myorder p">
					<div class="order">
						<div class="fl">
							<span>收货地址</span>
						</div>
						<div class="fl">
							<span class="li9">（该地址是商城回寄给您的地址）</span>
						</div>
					</div>
				</div>
				<div class="myorder p">
					<div class="order">
						<div class="fl">
							<span>所在地区：</span>
						</div>
						<div class="fl">
							<p class="addretu">广东省  深圳市  龙华新区</p>
						</div>
						<div class="fr">
							<i class="Mright"></i>
						</div>
					</div>
				</div>
				<div class="myorder cl-ordhi p">
					<div class="order">
						<div class="fl">
							<span>详细地址：</span>
						</div>
						<div class="fl">
							<textarea class="addretu2" name="" rows="" cols=""></textarea>
							<!--<p class="addretu2">广东深圳市龙华新区民治大道嘉熙业广场808室</p>-->
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="nextbutt">
            <input type="hidden" name="order_id" value="{$order.order_id}" />
            <input type="hidden" name="order_sn" value="{$order.order_sn}" />
            <input type="hidden" name="goods_id" value="{$goods.goods_id}" />
            <input type="hidden" name="spec_key" value="{$goods.spec_key}" />
            <input type="hidden" name="consignee" value="{$order.consignee}"/>
            <input type="hidden" name="mobile" value="{$order.mobile}" />
            <input type="hidden" name="id" value="{$return_goods.id}" />
            <input type="hidden" name="rec_id" value="{$goods.rec_id}" />
            <input type="hidden" name="reason" value="" />
			<a href="javascript:;" onclick="submit_form();">下一步</a>
		</div>
		</form>
<!--提交原因-s-->
<div class="losepay closeorder" style="display: ;">
    <div class="maleri30">
        <div class="l_top">
            <span>提交原因</span>
            <em class="turenoff" onclick="turenoff()"></em>
        </div>
        <div class="resonco">
            <div class="radio"><span class="che" data-val="订单不能按预计时间送达"><i></i><span>订单不能按预计时间送达</span></span></div>
            <div class="radio"><span class="che" data-val="操作有误（商品、地址等选错）"><i></i><span>操作有误（商品、地址等选错）</span></span></div>
            <div class="radio"><span class="che" data-val="重复下单/误下单"><i></i><span>重复下单/误下单</span></span></div>
            <div class="radio"><span class="che" data-val="其他渠道价格更低"><i></i><span>其他渠道价格更低</span></span></div>
            <div class="radio"><span class="che" data-val="该商品降价了"><i></i><span>该商品降价了</span></span></div>
            <div class="radio"><span class="che" data-val="不想买了"><i></i><span>不想买了</span></span></div>
        </div>
    </div>
</div>
<div class="mask-filter-div" style="display: none;"></div>
<!--提交原因-e-->
<script src="__STATIC__/js/style.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	function update_cause(){
		$('.resonco').text('');
		var index=$('a.red').attr('tvalue');

		var html={0: "                     <div class=\"radio\"><span class=\"che\" data-val=\"不喜欢/不想要\"><i></i><span>不喜欢/不想要</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"拍错了/订单信息错误\"><i></i><span>拍错了/订单信息错误</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"未按约定时间发货\"><i></i><span>未按约定时间发货</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"快递/物流一直未送到\"><i></i><span>快递/物流一直未送到</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"快递/物流无跟踪记录\"><i></i><span>快递/物流无跟踪记录</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"货物破损/空包裹已拒签\"><i></i><span>货物破损/空包裹已拒签</span></span></div>\n",
			1:
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"退运费\"><i></i><span>退运费</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"收到的商品与描述不符（大小/尺寸/颜色/图案/款式/材质面料等）\"><i></i><span>收到的商品与描述不符（大小/尺寸/颜色/图案/款式/材质面料等）</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"功能/效果与商品描述不符\"><i></i><span>功能/效果与商品描述不符</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"商品质量问题\"><i></i><span>商品质量问题</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"少件/漏发\"><i></i><span>少件/漏发</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"包装/商品破损/污渍\"><i></i><span>包装/商品破损/污渍</span></span></div>\n"+
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"假冒品牌\"><i></i><span>假冒品牌</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"未按约定时间发货\"><i></i><span>未按约定时间发货</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"发票问题\"><i></i><span>发票问题</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"卖家发错货\"><i></i><span>卖家发错货</span></span></div>\n",
			2:
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"7天无理由换货\"><i></i><span>7天无理由换货</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"大小/尺寸不合适\"><i></i><span>大小/尺寸不合适</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"颜色/款式不合适\"><i></i><span>颜色/款式不合适</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"商品质量问题\"><i></i><span>商品质量问题</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"假冒品牌\"><i></i><span>假冒品牌</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"收到的商品破损/漏件\"><i></i><span>收到的商品破损/漏件</span></span></div>\n"+
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"发票问题\"><i></i><span>发票问题</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"卖家发错货\"><i></i><span>卖家发错货</span></span></div>\n" ,
			3:
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"功能性故障或商品质量问题\"><i></i><span>功能性故障或商品质量问题</span></span></div>\n" +
					"                     <div class=\"radio\"><span class=\"che\" data-val=\"其它\"><i></i><span>其它</span></span></div>\n"
		}


		$('.resonco').append(html[index])
	}
	function cut_deliver(obj){
		var index=$('a.red').attr('tvalue');
		var clicked_id = $(obj).attr('rel')
		if(index==0){
			if(clicked_id==1){
				var html="                     <div class=\"radio\"><span class=\"che\" data-val=\"退运费\"><i></i><span>退运费</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"收到的商品与描述不符（大小/尺寸/颜色/图案/款式/材质面料等）\"><i></i><span>收到的商品与描述不符（大小/尺寸/颜色/图案/款式/材质面料等）</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"商品质量问题\"><i></i><span>商品质量问题</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"少件/漏发\"><i></i><span>少件/漏发</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"包装/商品破损/污渍\"><i></i><span>包装/商品破损/污渍</span></span></div>\n"+
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"假冒品牌\"><i></i><span>假冒品牌</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"未按约定时间发货\"><i></i><span>未按约定时间发货</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"发票问题\"><i></i><span>发票问题</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"卖家发错货\"><i></i><span>卖家发错货</span></span></div>\n"
			}else{
				var html=
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"不喜欢/不想要\"><i></i><span>不喜欢/不想要</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"拍错了/订单信息错误\"><i></i><span>拍错了/订单信息错误</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"未按约定时间发货\"><i></i><span>未按约定时间发货</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"快递/物流一直未送到\"><i></i><span>快递/物流一直未送到</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"快递/物流无跟踪记录\"><i></i><span>快递/物流无跟踪记录</span></span></div>\n" +
						"                     <div class=\"radio\"><span class=\"che\" data-val=\"货物破损/空包裹已拒签\"><i></i><span>货物破损/空包裹已拒签</span></span></div>\n";
			}
			$('.resonco').text('');
			$('.resonco').append(html)
		}
	}


    function turenoff(){
        $('.mask-filter-div').hide();
        $('.losepay').hide();
    }
	$(function(){
		//初始化 - 仅退款
		$('.clr_unfinished').show()
    	$('.clr_unfinished').find('span').addClass('check_t');
        $('.clr_achieve').show();
        $('#is_receive').val(0);
        
		$('.fuwxbo a').click(function(){
            var  typeval= $(this).attr('tvalue');
            if(typeval == 0){
            	//仅退款
            	$('.clr_unfinished').show()
            	$('.clr_unfinished').find('span').addClass('check_t');
				$('.clr_achieve').find('span').removeClass('check_t');
                $('.clr_achieve').show();
                $('#is_receive').val(0);
            }else if(typeval == 1 || typeval == 3){
            	//退货退款/维修
                $('.clr_unfinished').hide()
                $('.clr_unfinished').find('span').removeClass('check_t');
                
                $('.clr_achieve').show();
                $('.clr_achieve').find('span').addClass('check_t');
                
                $('#is_receive').val(1);
            }else{
                $('.clr_unfinished').show()
                $('#is_receive').val(1);
            }
			$(this).toggleClass('red').siblings().removeClass('red');
			update_cause()
		})

        $('.resonco span').click(function(){
            $('.resonco').find('.radio').find('.che').removeClass('check_t');
            $(this).addClass('check_t');
            //写入值
            var val = $(this).data('val');
            $('#account').text(val);
            $("input[name='reason']").val(val);
            //隐藏弹窗
            turenoff()
        })

        $(document).on('click','.account',function(){
            $('.mask-filter-div').show();
            $('.closeorder').show()
        })
		$('.inspectrepot .radio span').click(function(){
			$('.inspectrepot .che').removeClass('check_t');
			$(this).addClass('check_t');
			$('#is_receive').val($(this).attr('rel'));
		})
	})
			
    //显示上传照片
    window.URL = window.URL || window.webkitURL;
    function handleFiles(obj,id) {
        fileList = document.getElementById("fileList"+id);
        var files = obj.files;
        img = new Image();
        if(window.URL){

            img.src = window.URL.createObjectURL(files[0]); //创建一个object URL，并不是你的本地路径
            img.width = 60;
            img.height = 60;
            img.onload = function(e) {
                window.URL.revokeObjectURL(this.src); //图片加载后，释放object URL
            }
            if(fileList.firstElementChild){
                fileList.removeChild(fileList.firstElementChild);
            }
            fileList.appendChild(img);
        }else if(window.FileReader){
            //opera不支持createObjectURL/revokeObjectURL方法。我们用FileReader对象来处理
            var reader = new FileReader();
            reader.readAsDataURL(files[0]);
            reader.onload = function(e){
                img.src = this.result;
                img.width = 60;
                img.height = 60;
                fileList.appendChild(img);
            }
        }else
        {
            //ie
            obj.select();
            obj.blur();
            var nfile = document.selection.createRange().text;
            document.selection.empty();
            img.src = nfile;
            img.width = 60;
            img.height = 60;
            img.onload=function(){

            }
            fileList.appendChild(img);
        }
		// fileList.append()
		var close = new Image();
		close.src = "__STATIC__/images/clos.png"
		close.className = "upclose"
		fileList.appendChild(close)
	}

	$('.maleri30').on('click','.upclose',function(){
		event.stopPropagation()
		event.preventDefault()
		var father = $(this).parent()
		var index = father.attr('id').split('fileList')[1]
		// $(this).parent().siblings('input').get(0).files.splice()
		var box = father.parent().empty()
		box.html("<div class='shcph' id='fileList" +index+ "'><img src='__STATIC__/images/scph.png'></div><input  type='file' accept='image/*' name='return_imgs[]'  onchange='handleFiles(this," +index+ ")' style='display:none'>")
		console.log($('input[type="file"]'))
	})

	function submit_form()
    {
        var describe = $.trim($('#describe').val());
         var reason= $.trim($("input[name='reason']").val());
        if(reason == '')
        {
            showErrorMsg('请选择提交原因');
            return false;
        }
        if(describe == '')
        {
        	showErrorMsg('请输入问题描述!');// alert('请输入退换货原因!');
            return false;
        }
        $('#return_form').submit();
    }
    /**
     * 提示弹窗
     * @param msg
     */
    function showErrorMsg(msg){
        layer.open({content:msg,time:2});
    }
</script>
	</body>
</html>
