<include file="public/header" title="商品详情" body="g4"/>
<link rel="stylesheet" href="__STATIC__/css/shopdes.css"/>
<!-- 头部锚点 -->
<div id="spire-tire" style="width: 21.333rem"></div>
<div class="he_sustain">
    <!-- 头部导航 -->
    <div class="classreturn loginsignup detail">
        <div class="content">
            <div class="ds-in-bl return">
                <a href="javascript:history.back(-1)"><img src="__STATIC__/images/return.png" alt="返回"></a>
            </div>
            <div class="ds-in-bl search center" id="topcenter">
                <span class="sxp">商品</span>
                <span>详情</span>
                <span>评论</span>
            </div>
            <div class="ds-in-bl menu">
                <a href="javascript:void(0);"><img src="__STATIC__/images/class1.png" alt="菜单"></a>
            </div>
        </div>
    </div>
</div>
<!-- 头部锚点 -->
<div class="all-yanshi">
    <!--顶部隐藏菜单-s-->
    <include file="public/top_nav" cla="top-header-m"/>
    <!--顶部隐藏菜单-e-->

    <!--商品s-->
    <div class="xq_details" id="goodsInfoPage">
        <div class="hide-ajsk">
            <div class="banner ban1 detailban">
                <div class="mslide" id="slideTpshop">
                    <!-- 默认显示视频 -->
                    <ul style="display: none;">
                        <volist name="goods['goods_images']" id="img">
                            <li><a href="javascript:void(0)"><img src="{$img[image_url]}"></a></li>
                        </volist>
                    </ul>
                   
                        <if condition="!empty($goods['video'])">
                            <div class="videobox">
                                <video id="example_video_1"  controls
                                    x5-playsinline
                                    webkit-playsinline
                                    playsinline
                                    x-webkit-airplay="allow"
                                    x5-video-player-type="h5"
                                    width={document.documentElement.clientWidth}
                                    height={document.documentElement.clientWidth * 9 / 16}
                                    poster=""
                                    >
                                    <source src="{$goods['video']}" testsrc="http://vjs.zencdn.net/v/oceans.mp4" type="video/mp4">
                                </video>
                            </div>
                        </if>
                    
                    <if condition="!empty($goods['video'])">
                        <div class="tabbox"> 
                            <p class="on">视频</p>
                            <p >图片</p>
                        </div>
                    </if>
                    <!-- 拼图红标签s -->
                    <div class="timeafter team-pies clearfix" style="display: none">
                        <div class="confinetime">该商品参与拼团中</div>
                        <a class="team_button time-daoji" href="">点击前往</a>
                    </div>
                    <!-- 拼图红标签e -->
                </div>

                <!-- 秒杀红标题s -->
                <div class="timeafter presale-time" style="display: none">
                    <p class="confinetime" id="activity_type" style="color: #fff;margin-right: 0.512rem"></p>
                    <p class="confinetime" id="overTime" style="color: #fff;"></p>
                </div>
                <!-- 秒杀红标题e -->
                <p id="kanjia_t">
                    <em>砍价购</em>
                    <span style="float: right;margin-right: .5rem;font-size: .54rem;color: #fffafa;letter-spacing: .05rem;" id="kanjia_time">时间仅剩：<em></em></span>
                </p>
            </div>
            <div class="de_font p">
                <div class="thirty">
                    <div style="font-size: .64rem" class="similar-product-text" style="height: auto;">
                        {$goods.goods_name}
                    </div>
                    <div class="keep fr">
                        <a href="javascript:;">
                            <i class=""></i>
                            <span>分享</span>
                        </a>
                    </div>
                    <p class="red fl" id="price"><em>￥</em>{$goods.shop_price}</p>
                    <div class="scunde p">
                        <div class="clearfix">
                            <p style="float: right;"><span>销量：<span>{$goods.sales_sum + $goods.virtual_sales_sum}</span></span><span style="margin-left: 3.84rem"> 库存：<span class="spec_store_count">99</span>
                            </span>
                            </p>
                            <p style="float: left;"><span id="market_price_title">市场价</span><span class="linethr" id="market_price">￥{$goods.market_price}</span></p>
                        </div>
                        <p class="pre_sell_div" style="display: none; float: initial;">
                            订金：<span id="deposit_price" style="margin-right: 0.512rem"></span><span>尾款：<span id="balance_price"></span></span>
                        </p>
                    </div>
                </div>
            </div>
            <!--参与砍价 start-->
            <div class="floor list7 detailsfloo" id="kanjia" style="display: none;">
                <div class="myorder p " >
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl" style="width: 100%">
                                    <span class="firde" style="width: auto;">快来邀请好友砍价吧！</span>
                                    <span id="kanjia_list">

                                    </span>
                                    <span style="font-size: .46rem;color: #999;float: right" id="kanjia_num"> 0人正在参加</span>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
            <!--参与砍价&促销活动end -->
            <!--    选择优惠券模块开始-->
            <div class="coupon-select" <if condition="$goods.is_virtual eq 0"><else/>style="display: none"</if>>
                <div class="conpon-content coupon_click">
                    <em class="fl">优惠券</em>
                    <volist name="coupon_list" id="coupon" length='2'>
                        <span class="fl conpon-des" style="width:auto">满{$coupon.condition|intval}-{$coupon.money|intval}</span>
                    </volist>
                    <div class="fr">
                        <i class="Mright"></i>
                    </div>
                </div>
            </div>
            <div class="floor list7 detailsfloo" id="prom_order" <if condition="$prom_order AND $goods.prom_type neq 8 AND $goods.is_virtual eq 0"><else/>style="display: none"</if>>
                <div class="myorder p yan-sjyan">
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl">
                                    <span class="firde" style="height: 1.4rem;line-height: 1.4rem;margin-top: 0.2rem;">活动</span>
                                    <div class="deta-coupon1">
                                        <volist name="prom_order" id="vo">
                                            <div id="prom_order_{$vo.id}" style="height: 1.4rem;line-height: 1.4rem;"><em>{$vo.title}</em><span>{$vo.prom_detail}</span></div>
                                        </volist>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
         
            <div class="myorder p choise_num yansk-guige">
                <div class="content30">
                    <a href="javascript:void(0)">
                        <div class="order">
                            <div class="fl">
                                <span style="margin-left: 0;color:#666;width: 2.1333rem;font-size: .55467rem;" class="firde">规格</span>
                                <span class="sel" style="font-weight: bold;"></span>
                            </div>
                            <div class="fr">
                                <i class="Mright yan-assa"></i>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            <div style="height: .427rem;background-color: #f5f5f5;"></div>
            <!--    选择优惠券模块结束-->
            <div class="floor list7 detailsfloo">
                <div class="myorder p">
                    <div class="content30">
                        <a href="javascript:void(0)" onclick="locationaddress(this);">
                            <script type="text/javascript">
                                function locationaddress(e){
                                    $('.address_container').animate({height: $('#spire-tire').width()+'px', opacity: 'show'}, 'normal',function(){
                                        $('.address_container').show();
                                    });
                                    if(!$('.address_container').is(":hidden")){
                                        $('body').css('overflow','hidden')
                                        cover();
                                        $('.mask-filter-div').css('z-index','12');
                                    }
                                }
                                function closelocation(){

                                    $('.address_container').hide();
                                    $('body').css('overflow-y','scroll')
                                    undercover();
                                }
                            </script>
                            <div class="order">
                                <div class="fl">
                                    <span class="firde">地址</span>
                                    <span class="loc"></span>
                                    <span id="address"></span>
                                </div>
                                <div class="fr">
                                    <i class="Mright"></i>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="address_container">
                    <div class="add_show ">
                        <span class="show_text sel_show" onclick="toGetProvince();" data-id="{$address['province']}">
                            <volist name="province" id="sub">
                                <if condition="$address['province'] eq $sub['id']"> {$sub.name}</if>
                            </volist>
                        </span>
                        <span class="show_text no_sel" onclick="toGetCity();" data-id="{$address['city']}">
                            <volist name="city" id="sub">
                                <if condition="$address['city'] eq $sub['id']"> {$sub.name}</if>
                            </volist>
                        </span>
                        <span class="show_text no_sel" onclick="toGetDistrict();">
                            <volist name="district" id="sub">
                                <if condition="$address['district'] eq $sub['id']"> {$sub.name}</if>
                            </volist>
                        </span>
                        <span class="show_text no_sel" onclick="toGetTwon();">
                            <volist name="twon" id="sub">
                                <if condition="$address['twon'] eq $sub['id']"> {$sub.name}</if>
                            </volist>
                        </span>
                        <div class="close_add" style="float: right;display: block;padding: 0.8em;color: #999;" onclick="closelocation()">取消</div>
                    </div>
                    <div style="clear:both;"></div>
                    <div class="add_select">
                        <div class="province-list2"></div>
                        <div class="city-list2" style="display: none;"></div>
                        <div class="area-list2" style="display: none"></div>
                        <div class="twon-list2" style="display: none"></div>
                    </div>
                </div>
                <!--配送至-e-->

                <!--运费-s-->
                <if condition="$goods.is_virtual neq 1">
                    <div class="myorder p" id="dispatching_desc">
                        <div class="content30">
                            <a class="remain" href="javascript:void(0);">
                                <div class="order">
                                    <div class="fl">
                                        <span class="firde">运费</span>
                                        <span id="shipping_freight"></span>
                                    </div>
                                </div>
                            </a>
                        </div>
                    </div>
                </if>
                <!--运费-s-->
                <div style="height: 2rem;"  class="myorder p">
                    <div class="content30">
                        <a href="javascript:void(0)">
                            <div class="order">
                                <div class="fl">
                                    <span class="firde">服务</span>
                                    <span>由{$goods['store']['store_name']}提供服务</span>
                                
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
                <div style="display: none" class="myhearders myorder">
                    <div class="scgz descgz">
                        <ul>
                            <if condition="$goods['store']['certified'] eq 1">
                                <li>
                                    <a href="javascript:void(0);">
                                        <img src="__STATIC__/images/hdfk.png">
                                        <p>正品保障</p>
                                    </a>
                                </li>
                            </if>
                            <if condition="$goods['store']['qitian'] eq 1">
                                <li>
                                    <a href="javascript:void(0);">
                                        <i><em>{$tpshop_config['shopping_auto_service_date']}</em></i>
                                        <p>{$tpshop_config['shopping_auto_service_date']}天退款</p>
                                    </a>
                                </li>
                            </if>
                            <if condition="$goods['store']['two_hour'] eq 1">
                                <li>
                                    <a href="javascript:void(0);">
                                        <img src="__STATIC__/images/ksd.png">
                                        <p>极速达</p>
                                    </a>
                                </li>
                            </if>
                        </ul>
                    </div>
                </div>
            </div>
            <div style="height: .427rem;background-color: #f5f5f5;"></div>
        </div>
        <!-- 评价头部s -->
        <div class="myorder p tbv pinlun-des">
            <div class="content30">
                <a href="javascript:void(0)">
                    <div class="order">
                        <div class="fl">
                            <span class="firde yonghu-pinjia">用户评价<b class="yasan-ajdas">({$goods['comment_statistics']['high_sum']})</b></span>
                            <!-- <span style="margin-left: 3.776rem">好评率</span> -->
                        </div>
                        <div class="fr pinjia-ans">
                            <span>好评<i>{$goods['comment_statistics']['high_rate']}%</i></span>
                            <i class="Mright yans-ahsj"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
        <!-- 评价头部e -->
        <!--评论列表-s-->
        <div class="xq_details1" >
            <!--1 全部 2好评 3 中评 4差评-->
            <div class="sjs-pinjias"   style="display:none;">
                <div class="spxq-ggcs comment_de p">
                    <ul>
                        <li class="red">全部<span ctype="1">{$goods['comment_statistics']['total_sum']}</span></li>
                        <li>好评<span ctype="2">{$goods['comment_statistics']['high_sum']}</span></li>
                        <li>中评<span ctype="3">{$goods['comment_statistics']['center_sum']}</span></li>
                        <li>差评<span ctype="4">{$goods['comment_statistics']['low_sum']}</span></li>
                        <li>有图<span ctype="5">{$goods['comment_statistics']['img_sum']}</span></li>
                    </ul>
                </div>
                <!--评论列表-->
                <div class="tab-con-wrapper my_comment_list" ></div>
            </div>
            <!--评论列表-->
            <div class="tab-con-wrapper my_comment_list" ></div>
        </div>
        <!--评论列表-e-->
        <div class="hide-jsadh">
            <div style="height: .427rem;background-color: #f5f5f5;"></div>
            <!-- 进入店铺s -->
            <div class="detailsfloo padey">
                <div class="storemess">
                    <div class="maleri30">
                        <div class="top_storeme p">
                            <div class="spelee">
                                <a href="{:U('Store/index',array('store_id'=>$goods[store_id]))}">
                                    <img src="{$goods['store']['store_avatar']|default='__STATIC__/images/logo.png'}">
                                </a>
                            </div>
                            <div class="nxnan">
                                <a href="{:U('Store/index',array('store_id'=>$goods[store_id]))}">
                                    <h2>{$goods['store']['store_name']}</h2>
                                </a>
                                <div class="guanzhi-nuber">
                                    <span>关注人数:{$goods['store']['store_collect']}</span>
                                    <span>商品数量:{$good_num}</span>
                                </div>
                            </div>
                            <a href="{:U('Store/index',array('store_id'=>$goods[store_id]))}"><div class="jindain-guai">进店逛逛</div></a>
                        </div>
                        <div class="mid_storeme p">
                            <ul>
                                <li>
                                    <div class="commeaye">
                                        <p class="sh_pp"><span>商品评价</span>

                                            <?php
                                                $cls=array('高'=>"yuanda-gao",'中'=>"yuanda-zhong",'低'=>"yuanda-di");
                                                $store_desccredit=getStoreScoreDec($goods['store']['store_desccredit']);
                                            ?>
                                            <span class="red"><em>{$goods['store']['store_desccredit']}</em><b class="{$cls[$store_desccredit]}">{$goods['store']['store_desccredit']|getStoreScoreDec}</b></span>
                                        </p>
                                    </div>
                                </li>
                                <li>
                                    <div class="commeaye">
                                        <?php $store_servicecredit=getStoreScoreDec($goods['store']['store_servicecredit']);?>
                                        <p class="sh_pp"><span>服务评价</span><span class="red"><em>{$goods['store']['store_servicecredit']}</em><b class="{$cls[$store_servicecredit]}">{$goods['store']['store_servicecredit']|getStoreScoreDec}</b></span></p>
                                    </div>
                                </li>
                                <li>
                                    <div class="commeaye">
                                        <?php $store_deliverycredit=getStoreScoreDec($goods['store']['store_deliverycredit']);?>
                                        <p class="sh_pp"><span>物流评价</span><span class="red"><em>{$goods['store']['store_deliverycredit']}</em><b class="{$cls[$store_deliverycredit]}">{$goods['store']['store_deliverycredit']|getStoreScoreDec}</b></span></p>
                                    </div>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 进入店铺e -->
            <div class="line-xian"></div>
            <div class="recommed p">
                <h2>为您推荐</h2>
                <div class="floor guesslike">
                    <div class="likeshop">
                        <ul>
                            <!--商品推荐-->
                            <tpshop sql="SELECT * FROM __PREFIX__goods WHERE ( is_recommend=1 and is_on_sale=1 ) ORDER BY goods_id DESC LIMIT 0,6 " key="k" item='v'>
                                <li>
                                    <a href="{:U('Goods/goodsInfo',array('id'=>$v[goods_id]))}">
                                        <div class="similer-product">
                                            <img src="{$v.goods_id|goods_thum_images=400,400}">
                                            <span class="similar-product-text ">{$v[goods_name]}</span>
                                            <span class="similar-product-price">
                                                <em>¥</em> <span class="big-price">{$v[shop_price]}</span>
                                            </span>
                                        </div>
                                    </a>
                                </li>
                            </tpshop>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    
        <!--添加购物车JS-->
        <script src="__PUBLIC__/js/mobile_common.js" type="text/javascript" charset="utf-8"></script>
    </div>
    <!--商品-e-->
</div>
<!--分享-s-->
<div class="fenxiang_two">
    <img src="__STATIC__/images/share_tips.png" alt="">
</div>
<div class="bg_posters">
    <div class="flex">
        <div class="posters_photo">
            <div class="img">
                <img data-src="{:U('mobile/goods/goodsSharePoster',['id'=>$goods['goods_id']])}" id="src_posters">
            </div>
            <div class="save">
                <p>长按图片后可保存到相册</p>
                <img class="posters_img" src="__STATIC__/images/share_close.png" alt="">
            </div>
        </div>
    </div>
</div>
<div class="fenxiang-1">
    <div class="bg-fenxiang"></div>
    <div class="img-wen">
        <div class="copy_link">
            <img src="__STATIC__/images/share-lj.png" alt="">
            <span>复制链接</span>
        </div>
        <div class="posters">
            <img src="__STATIC__/images/share-posters.png" alt="">
            <span>生成海报</span>
        </div>
        <div class="share_wx">
            <img src="__STATIC__/images/share-wx.png" alt="">
            <span>微信分享</span>
        </div>
    </div>
    <p class="cancel">取消</p>
</div>
<!--分享-e-->
<script>
    // 分享功能-s
    $('.keep').on('click',function(){
        $('.fenxiang-1').show();
        if(!isWeiXin()){
            $('.share_wx').hide();
        }
    })
    $('.bg-fenxiang').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $('.cancel').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $('.cancel').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $(".copy_link").click(function(){                          //复制当前网页链接
        var user_id = getCookie('user_id'); // 当前用户id
        var is_distribut = getCookie('is_distribut'); // 是否分销代理
        var url = window.location.href;
        // 如果已经登录了, 并且是分销商 拼团分销链接分享
        if(parseInt(is_distribut) == 1 && parseInt(user_id) > 0)
        {
            if(url.indexOf('&')>0){
                url = url + "&first_leader="+user_id;
            }else{
                url = url + "/first_leader/"+user_id;
            }
        }
        var successful;
        if (navigator.userAgent.match(/(iPhone|iPod|iPad|iOS)/i)) { //ios
            var copyDOM = document.createElement('div');  //要复制文字的节点
            copyDOM.innerHTML = url;
            document.body.appendChild(copyDOM);
            var range = document.createRange();
            // 选中需要复制的节点
            range.selectNode(copyDOM);
            // 执行选中元素
            window.getSelection().addRange(range);
            // 执行 copy 操作
            successful = document.execCommand('copy');
            // 移除选中的元素
            window.getSelection().removeAllRanges();
            $(copyDOM).hide()
        }else{
            var oInput = document.createElement('input')
            oInput.value = url;
            document.body.appendChild(oInput)
            oInput.select() // 选择对象
            successful = document.execCommand('Copy') // 执行浏览器复制命令
            oInput.className = 'oInput'
            oInput.style.display = 'none'
            oInput.remove()
        }
        if(successful){
            layer.open({icon: 1, content: "复制成功", time: 2});
            $('.fenxiang-1').hide();
        }else{
            layer.open({icon: 1, content: "复制失败", time: 2});
            $('.fenxiang-1').hide();
        }
    });
    //    生成海报
    $('.posters').on('click',function(){
        $('.bg_posters').show();
        $('.fenxiang-1').hide();
        if($("#src_posters").attr('src') == undefined){
            $("#src_posters").attr('src',$("#src_posters").attr('data-src'));
        }
    })
    $('.bg_posters').on('click',function(){        //关闭海报
        $('.bg_posters').hide();
    })
    $('.posters_img').on('click',function(){
        $('.bg_posters').hide();
    })
    $('.share_wx').on('click',function(){
        $('.fenxiang_two').show();
        $('.fenxiang-1').hide();
    })
    $('.fenxiang_two').on('click',function(){
        $('.fenxiang_two').hide();
    })
    $(".fenxiang-1").on("touchmove",function(){
        event.preventDefault();
    });
    // 分享功能-e
</script>
<!--详情-s-->
<div class="xq_details shou-hieh">
    <div class="spxq-ggcs">
        <ul>
            <li class="red">商品详情</li>
            <li>规格参数</li>
        </ul>
    </div>
    <div class="sg">
        <div class="spxq p">
            <notempty name="goods.mobile_content">
                {$goods.mobile_content_html}
                <else />
                {$goods.goods_content|htmlspecialchars_decode}
            </notempty>
        </div>
    </div>
    <div class="sg" style="display: none;">
        <div class="spxq p">
            <table class="de_table" border="1" bordercolor="#cbcbcb" style="border-collapse:collapse;">
                <tr>
                    <th colspan="2">主体</th>
                </tr>
                <volist name="goods_attr" id="attr">
                    <tr>
                        <td>{$goods_attribute[$attr[attr_id]]}</td>
                        <td>{$attr[attr_value]}</td>
                    </tr>
                </volist>
            </table>
        </div>
    </div>
</div>
<!--详情-e-->

<!--底部导航-s-->
<div class="podee">
    <div class="cart-concert-btm p">
        <div class="fl">
            <ul>
                <li>
                    <if condition="(!empty($kf_config['im_choose'])) && ($kf_config['im_choose'] eq 1)">
                        <!--im客服-->
                        <a class="kf" href="{:U('supplier/index',array('store_id'=>$goods[store_id],'goods_id'=>$goods['goods_id']))}">
                            <i></i>
                            <p>客服</p>
                        </a>
                        <elseif condition="(!empty($kf_config['im_choose'])) && ($kf_config['im_choose'] eq 2)" />
                        <!--小能客服-->
                        <a href="javascript:;">
                            <i></i>
                            <p>客服</p>
                        </a>
                        <else />
                        <!--早先客服-->
                        <!--<a href="tel:{$tpshop_config['shop_info_phone']}">-->
                        <a href="mqqwpa://im/chat?chat_type=wpa&uin={$goods['store']['store_qq']}&version=1&src_type=web&web_src=www.chinesestack.com">
                            <i></i>
                            <p>客服</p>
                        </a>
                    </if>
                </li>
                <li>
                    <a href="javascript:;" id="favorite" data-goods-id="{$goods['goods_id']}">
                        <i class="shoucang <if condition='$collect gt 0'>shoucang-1</if>"></i>
                        <p>收藏</p>
                    </a>
                </li>
                <li>
                    <a href="{:U('Mobile/Cart/index')}" >
                        <span id="tp_cart_info"></span>
                        <i class="gwc"></i>
                        <p>购物车</p>
                    </a>
                </li>
            </ul>
        </div>
        <div class="fr">
            <ul id="btnbox" style="display:none">
                <li class="o" id="join_cart_li">
                    <a class="pb_plusshopcar button active_button choise_num" href="javascript:void(0);"> 加入购物车</a>
                </li>
                <li class="r" id="buy_now_li">
                    <a class="choise_num" style="display:block;" href="javascript:void(0);">立即购买</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<!--底部导航-e-->

<!--点赞弹窗-s-->
<div class="alert">
    <img src="__STATIC__/images/hh.png"/>
    <p>您已经赞过了！</p>
</div>
<!--点赞弹窗-e-->

<!--优惠券弹窗开始-->
<div class="coupon-list p">
	<div class="salpro-tit">
		<b>优惠券列表</b>
		<div class="price_or fr"><i class="xxgro"></i></div>
	</div>
	<div class="dc-pck">
		<div class="deta-coucon">
		<volist name="coupon_list" id="coupon">
			<div class="deta-coulist">
				<div class="fl">
					<span>￥<b>{$coupon.money}</b></span><em>满{$coupon.condition|intval}元可用</em>
				</div>
				<div class="fr">
					<p>
						{$coupon.name}
						<if condition="!empty($goods_coupon[$coupon['id']])">
							&nbsp;-&nbsp;
							<if condition="empty($goods_coupon[$coupon['id']]['goods_name'])">
								指定商品分类：{$goods_coupon[$coupon['id']]['mobile_name']}
							<else />
								指定商品：{$goods_coupon[$coupon['id']]['goods_name']}
							</if>
						</if>
					</p>
					<span>
						<i>{$coupon.use_start_time|date='y.m.d',###}-{$coupon.use_end_time|date='y.m.d',###}</i>
						<empty name="$coupon.is_own">
							<a href="javascript:void(0)" data-coupon-id="{$coupon.id}" onclick="getCoupon(this)">点击领取</a>
						<else />
							<a href="javascript:void(0)">已领取</a>
						</empty>
					</span>
				</div>
			</div>
		</volist>
		</div>
	</div>
</div>

<!-- 收藏弹窗 -->
<div class="alter-shoucan-1">
    <div class="alter-an">
        <div class="p-1">
            <img src="__STATIC__/images/withdraw-cheng.png" alt="">
            <p></p>
        </div>
    </div>
</div>
<!--选择属性的弹窗-s-->
<form name="buy_goods_form" method="post" id="buy_goods_form"  action="">
    <input type="hidden" name="form" value="1"><!-- 标识商品详情表单提交 -->
    <input type="hidden" name="goods_id" value="{$goods.goods_id}"><!-- 商品id -->
    <input type="hidden" name="activity_is_on" value=""><!-- 活动是否进行中 -->
    <input type="hidden" name="goods_prom_type" value="{$goods.prom_type}"/><!-- 活动类型 -->
    <input type="hidden" name="shop_price" value="{$goods.shop_price}"/><!-- 活动价格 -->
    <input type="hidden" name="store_count" value="{$goods.store_count}"/><!-- 活动库存 -->
    <input type="hidden" name="market_price" value="{$goods.market_price}"/><!-- 商品原价 -->
    <input type="hidden" name="start_time" value=""/><!-- 活动开始时间 -->
    <input type="hidden" name="end_time" value=""/><!-- 活动结束时间 -->
    <input type="hidden" name="activity_title" value=""/><!-- 活动标题 -->
    <input type="hidden" name="buy_limit" value=""/><!-- 活动标题 -->
    <input type="hidden" name="item_id" value="{$Request.param.item_id}"/><!-- 商品规格id -->
    <input type="hidden" name="prom_id" value="{$goods.prom_id}"/><!-- 活动ID -->
    <input type="hidden" name="exchange_integral" value="{$goods.exchange_integral}"/><!-- 积分 -->
    <input type="hidden" name="point_rate" value="{$point_rate}"/><!-- 积分兑换比 -->
    <input type="hidden" name="is_virtual" value="{$goods.is_virtual}"/><!-- 是否是虚拟商品 -->
    <input type="hidden" name="virtual_limit" id="virtual_limit" value="{$goods.virtual_limit}"/>
    <input type="hidden" name="end_price" value=""/><!--砍价最低 -->
    <input type="hidden" name="goods_store_count" value=""/><!-- 单独购库存 -->
    <input type="hidden" name="prom_type" value="{$goods.prom_type}"/><!-- 适用砍价活动类型 -->
    <input type="hidden" name="is_normal" value=""/><!-- 砍价活动购买操作，单独购标识(普通购买流程) -->

    <!-- 预售使用 s-->
    <input type="hidden" name="prom_id" value=""/><!-- 活动id -->
    <input type="hidden" name="deposit_price" value=""/><!-- 订金 -->
    <input type="hidden" name="balance_price" value=""/><!-- 尾款 -->
    <input type="hidden" name="ing_amount" value=""/><!-- 已预订了多少 -->
    <!-- 预售使用 e-->
    <div class="choose_shop_aready p">
        <!--商品信息-s-->
        <div class="shop-top-under p">
            <div class="maleri30">
                <div class="shopprice">
                    <div class="img_or fl"><img id="zoomimg" src="{$goods.goods_id|goods_thum_images=200,200}"></div>
                    <div class="fon_or fl">
                        <h2 class="similar-product-text">{$goods.goods_name}</h2>
                        <div class="price_or"><span>￥</span><span id="goods_price">{$goods.shop_price}</span></div>
                        <div class="dqkc_or"><span>剩余库存：</span><span id="spec_store_count">{$goods.store_count}</span></div>
                        <div class="dqkc_or buy_limit" style="display: none"><span>限购：</span><span id="buy_limit">{$goods.virtual_limit}</span></div>
                        <div class="price_or team-pies p" style="display: none"><span class="confinetime">该商品拼团中</span><a class="pb_buy team_button">点击前往</a></div>
                    </div>
                    <div class="price_or fr">
                        <i class="xxgro"></i>
                    </div>
                </div>
            </div>
        </div>
        <!--商品信息-e-->
        <div class="shop-top-under p">
            <div class="maleri30">
                <if condition="$filter_spec neq ''">
                    <foreach item="spec" key="key" name="filter_spec">
                        <div class="shulges p choicsel">
                            <p>{$key}</p>
                            <!-------商品属性值-s------->
                            <foreach name="spec" item="v2" key="k2">
                                <div class="plus choic-sel">
                                    <a id="goods_spec_a_{$v2[item_id]}" title="{$v2[item]}"
                                       onclick="switch_spec(this); <if condition="!empty($v2['src'])" >$('#zoomimg').attr('src','{$v2[src]}');</if>">
                <input id="goods_spec_{$v2[item_id]}" type="radio" style="display:none;" name="goods_spec[{$key}]" value="{$v2[item_id]}"/>{$v2[item]}</a>
            </div>
            </foreach>
            <!-------商品属性值-e-------->
        </div>
        </foreach>
        </if>
        <div class="shulges p am-anshd">
            <p>数量</p>
            <!--选择数量-->
            <div class="plus">
                <span class="mp_minous"  onclick="altergoodsnum(-1)">-</span>
                <span class="mp_mp">
                <input type="tel" class="num buyNum" id="number" residuenum="{$goods.store_count}" name="goods_num" value="1" min="1" max="{$goods.store_count}" onblur="altergoodsnum(0)">
                        </span>
                <span class="mp_plus" onclick="altergoodsnum(1)">+</span>
            </div>
        </div>
    </div>
    </div>
    <div class="btns-fixed-wrap">
        <div style="background: #fff" class="plusshopcar-buy p btns-fixed-w100">
            <a id="join_cart" class="pb_plusshopcar button active_button dis_btn" href="javascript:void(0);">加入购物车</a>
            <a id="buy_now" class="pb_buy dis_btn" href="javascript:void(0);" >立即购买 </a>
        </div>
    </div>
    </div>
</form>
<!--选择属性的弹窗-e-->
<a onclick="$('html,body').animate({'scrollTop':0},600)" style="display: block;width: 1.706667rem;height:1.706667rem;position: fixed; bottom: 3rem;right:0.4rem; background-color: rgba(243,241,241,0.5);border: 1px solid #CCC;-webkit-border-radius: 50%;-moz-border-radius: 50%;border-radius: 50%;" id="topup">
    <img src="/template/mobile/default/static/images/topup.png" style="display: block;width: 1.706667rem;height:1.706667rem;">
</a>

<div class="mask-filter-div" style="display: none;"></div>
<div class="BDmap" style="display: none"></div>
<!--定位-->
<script src="{$Think.const.HTTP}://api.map.baidu.com/api?v=2.0&ak=xXo650H9zUKh1Lk19uBaNcEWLoG3eGBU" type="text/javascript" c="{$tpshop_config.basic_bd_ak}"></script>
<script type="text/javascript">
    var cur_lng = 114.02597366; // 获取当前坐标 lng
    var cur_lat = 22.54605355; // 获取当前坐标 lat
    var auto_bd = 0; // 是否百度定位
    function current_location() {
        var dis = getCookie('district_name');
        if(!dis){
            auto_bd = 1;
            var geolocation = new BMap.Geolocation();
            geolocation.getCurrentPosition(function (r) {
                if (this.getStatus() == BMAP_STATUS_SUCCESS) {
                    var geoc = new BMap.Geocoder();
                    geoc.getLocation(r.point, function (rs) {
                        /*city: "深圳市"
                         district: "福田区"
                         province: "广东省"
                         street: "农轩路"
                         streetNumber: "55号"*/
                        var addressComp = rs.addressComponents;

                        setCookies('province_name', addressComp.province, 30 * 24 * 60 * 60 * 1000);
                        setCookies('city_name', addressComp.city, 30 * 24 * 60 * 60 * 1000);
                        setCookies('district_name', addressComp.district, 30 * 24 * 60 * 60 * 1000);
                        $('#address').text(addressComp.province+addressComp.city+addressComp.district);
                        auto_bd = 2;
                        ajaxDispatching();
                        province_name = getCookie('province_name');
                        city_name = getCookie('city_name');
                        district_name = getCookie('district_name');
                    });
                }
                else {
                    // 定位失败调用默认地址
                    auto_bd = 0;
                    locationInitialize();
                    ajaxDispatching();
                }
            }, {enableHighAccuracy: true})
        }
    }
    current_location();
</script>
<script src="__STATIC__/js/mobile-location.js?11"></script>
<script type="text/javascript" src="__STATIC__/js/lefttime.js"></script>
<script src="__STATIC__/js/style.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    // 播放功能js代码S
    $('.tabbox p').bind('click',function(){
        $('.tabbox p').each(function(){
            $(this).removeClass('on')
        })
        $(this).addClass('on')
        
        if($(this).index()==0){
            $('#slideTpshop ul').hide()
            $('#slideTpshop .dot').hide()
            $('#slideTpshop .videobox').show()
        }else if($(this).index()==1){
            $('#slideTpshop ul').show()
            $('#slideTpshop .dot').show()
            $('#slideTpshop .videobox').hide()
            $('#example_video_1').get(0).pause()
        }
    })
    
    //根据活动内容设置播放器高度
    function setHeight(){
        var set = false
        $('.timeafter').each(function(){
            if($(this).css("display")!=='none'){
                set = true
            }        
        })
        if(set){ //需要降低播放器高度
            $('#example_video_1').css('height','14.46rem')
        }
    }
    
    $('#example_video_1').bind('ended',function(){
        $('#example_video_1').get(0).currentTime = 0
        $('#example_video_1').get(0).pause()
    })
    setTimeout(function(){
        try{  //初始化设定各组件显示隐藏
            if($('.tabbox p').eq(0).attr('class').indexOf('on')>-1){   //如果初始化选定的是视频时
                $('#slideTpshop ul').hide()
                $('#slideTpshop .dot').hide()
                $('#slideTpshop .videobox').show()
            }else{
                $('#slideTpshop ul').show()
                $('#slideTpshop .dot').show()
                $('#slideTpshop .videobox').hide()
            }
        }catch(e){
            $('#slideTpshop ul').show()
            $('#slideTpshop .dot').show()
            $('#slideTpshop .videobox').hide()       
        }
        
    },10);

    // 播放功能js代码E

	/**
     * 优惠卷
     */
    $('.coupon_click').click(function () {
        cover();
        $('.coupon-list').show();
        $('.podee').hide();
    })

    //关闭优惠卷列表
    $('.xxgro').click(function () {
        undercover();
        $('.coupon-list').hide();
        $('.podee').show();
    })
    //    无优惠券时隐藏优惠券模块
    $(function(){
        function coupon(){
            var goods_prom_type = $('input[name="goods_prom_type"]').attr('value');//活动类型
            var is_virtual =  "{$goods.is_virtual}";
            if($(".coupon-select .conpon-content").find(".conpon-des").text() && goods_prom_type != 8 && is_virtual == 0){ //砍价活动隐藏
                $(".coupon-select").css({"display":"block"})
            }else{
                $(".coupon-select").css({"display":"none"})
            }
        }
        var number=setInterval(function(){
            coupon();
        },1000)
    })
	//领取优惠卷
	function getCoupon(obj){
		$.ajax({
			type: "POST",
			url: "{:U('Mobile/User/getCoupon')}",
			data: {coupon_id: $(obj).data('coupon-id')},
			dataType: "json",
			error: function () {
				layer.alert("服务器繁忙, 请联系管理员!");
			},
			success: function (data) {
				if (data.status == 1) {
					layer.open({content: data.msg,skin: 'msg',time: 2});
					$(obj).parent().empty().append('<a href="javascript:void(0)">已领取</a>');
				} else {
					layer.open({content: data.msg,skin: 'msg',time: 2});
				}
			}
		});
	}

    var commentType = 1;// 默认评论类型
    var spec_goods_price = {$spec_goods_price|default='null'};//规格库存价格
    var spec_empty_object = $.isEmptyObject(spec_goods_price);
    //页面加载后执行
    $(document).ready(function () {
        ajax_header_cart();
        ajaxComment(commentType, 1);// ajax 加载评价列表
        initSpec();
        sel(); //在已选栏中显示默认选择属性，数量
        initGoodsPrice();
    });

    var buy_now = $('#buy_now');
    var join_cart = $('#join_cart');
    var buy_now_li = $('#buy_now_li');
    var join_cart_li = $('#join_cart_li');
	var buy_or_join = -1; //砍价时判断是点了单独购（0）还是砍价拿（1）进去选择规格页面的
	var activity_button = -1; //进去选择规格页面时是有活动还是没活动（活动按钮还是正常按钮）
    function buy_button(){
        var is_virtual = $("input[name='is_virtual']").val();//是否是虚拟商品
        var exchange_integral = $("input[name='exchange_integral']").val();//是否是为积分商品
        var goods_prom_type = $('input[name="goods_prom_type"]').attr('value');//活动商品
        var activity_is_on = $('input[name="activity_is_on"]').attr('value'); //活动是否进行中
        buy_now.hide();
        buy_now_li.hide();
        join_cart.hide();
        join_cart_li.hide();
        if(is_virtual == 1){
            buy_now_li.find('.choise_num').html('立即购买');
            buy_now_li.width('100%').show();
            buy_now.html('立即购买').show();
            return;
        }
        if(exchange_integral > 0){
            buy_now_li.find('.choise_num').html('立即兑换');
            buy_now_li.width('100%').show();
            buy_now.html('立即兑换').show();
            return;
        }
        if(goods_prom_type == 4 && activity_is_on == 1){
            buy_now_li.find('.choise_num').html('立即预订');
            buy_now_li.width('100%').show();
            buy_now.html('立即预订').show();
            return;
        }
        if(goods_prom_type == 8){
            var group_by_price = $("input[name='shop_price']").attr('value');
            var end_price = $("input[name='end_price']").attr('value');
            if (activity_is_on == 1 && activity_button != 0) {
				var buy_html = "<em style='display: inline-block;margin-top: -.7rem;font-size: 0.5rem;'>砍价拿</em><em style='margin-top: -.7rem;display: inline-block;font-size: 0.5rem;'>￥"+end_price+"</em>";
				var join_html = "<em style='display: inline-block;margin-top: -.7rem;font-size: 0.5rem;'>单独购</em><em style='display: inline-block;margin-top: -.7rem;font-size: 0.5rem;'>￥"+group_by_price+"</em>";
			} else {
				var buy_html = "立即购买";
				var join_html = "加入购物车";
			}
			if (buy_or_join == 0) {
				buy_html = "确定";
			} else {
				
			}
            buy_now_li.find('.choise_num').css('line-height','2.13333rem');
            buy_now_li.find('.choise_num').html(buy_html);
            buy_now_li.width('50%').show();
            buy_now.css('line-height','1.3rem');
            buy_now.html(buy_html).width('50%').show();
            //join_cart.css('line-height','1.3rem');
            //join_cart.html(join_html).width('50%').show();
            join_cart_li.find('.choise_num').css('line-height','2.13333rem');
            join_cart_li.find('.choise_num').html(join_html);
            join_cart_li.width('50%').show();

			buy_now.width('100%').show();
			join_cart.hide();
            return;
        } else {
			buy_now_li.show();
			join_cart_li.show();
			//buy_now.html('立即购买').show();
			buy_now.width('50%').show();
			join_cart.show();
		}
    }

    //点击砍价更换标签内容
    $('#buy_now_li').on('click',function () {
        if($(this).find('em').html() == '砍价拿'){
            var end_price = $("input[name='end_price']").attr('value');
            var buy_html = "<em>砍价拿</em><em style='margin-top: -.7rem'>￥"+end_price+"</em>";
            setTimeout(function () {
                $('.choose_shop_aready').find('#buy_now').html(buy_html);
            },250)
        }
    })

    //购买按钮
    $(function () {
        //立即购买
        $(document).on('click', '#buy_now', function () {
            if ($(this).hasClass('dis')) {
                return;
            }
            if (getCookie('user_id') == '') {
                window.location.href = "{:U('Mobile/User/login')}";
                return;
            }
            var is_virtual = $("input[name='is_virtual']").val();//是否是虚拟商品
            var exchange_integral = $("input[name='exchange_integral']").val();//是否是积分兑换商品
            var goods_id = $("input[name='goods_id']").val();
            var store_count = $("input[name='store_count']").attr('value');// 商品原始库存
            var goods_num = parseInt($("input[name='goods_num']").val());
            var goods_prom_type = $('input[name="goods_prom_type"]').attr('value');//活动商品
            var activity_is_on = $('input[name="activity_is_on"]').attr('value'); //活动是否进行中
            var form = $('#buy_goods_form');
            if (is_virtual == 1) {
                var virtual_limit = parseInt($('#virtual_limit').val());
                if ((goods_num <= store_count && goods_num <= virtual_limit) || (goods_num < store_count && virtual_limit == 0)) {
                    form.attr('action', "{:U('Mobile/Cart/cart2',['action'=>'buy_now'])}").submit();
                } else {
                    //layer.msg('购买数量超过此商品购买上限', {icon: 3});
                    layer.open({content: '购买数量超过此商品购买上限', skin: 'msg', time: 2});
                }
                return;
            }
            if (exchange_integral > 0) {
                buyIntegralGoods(goods_id, 1);
                return;
            }
            if(goods_prom_type == 4 && activity_is_on == 1){
                form.attr('action', "{:U('mobile/Cart/pre_sell')}").submit();
                return;
            }
            if(goods_prom_type == 8){
                if(goods_num <=0){
                    layer.open({icon: 2, content: "购买数量不能为0", time: 2});
                    return false;
                }
				if (buy_or_join == 1 &&  activity_button == 1 && activity_is_on == 1) {
					//发起砍价
					add_cut();
					return false;
				} else if (buy_or_join == 0 &&  activity_button == 0) {
					$('#join_cart').trigger('click');
					return false;
				}
				//走下面的普通流程,去掉砍价活动的标识
				$("input[name='is_normal']").val('1');
            }
            //普通流程
            if (goods_num <= store_count) {
                form.attr('action', "{:U('mobile/Cart/cart2',['action'=>'buy_now'])}").submit();
            } else {
                //layer.msg('购买数量超过此商品购买上限', {icon: 3});
                layer.open({content: '购买数量超过此商品购买上限', skin: 'msg', time: 2});
            }
        })
        //加入购物车
        $(document).on('click', '#join_cart', function () {
            if ($(this).hasClass('dis')) {
                return;
            }
            var goods_id = $("input[name='goods_id']").val();
            AjaxAddCart(goods_id, 1);
            //只有砍价适用s
            $("input[name='goods_prom_type']").val($("input[name='prom_type']").val());
            if($("input[name='prom_type']").val() == 8){
                goods_activity_theme();
                buy_button();
            }
            //只有砍价适用e
			$('.xxgro').trigger('click');
        })
    })

    //有规格id的时候，解析规格id选中规格
    function initSpec() {
		var item_id = $("input[name='item_id']").val();
		if (!item_id && !$.isEmptyObject(spec_goods_price)) {
			//如果没有传item_id参数过来，优先显示有活动的商品规格
			var xx;
			for (xx in spec_goods_price) {
				if (spec_goods_price[xx]['prom_id'] > 0) {
					item_id = spec_goods_price[xx]['item_id'];
					$("input[name='item_id']").val(item_id);
					break;
				}
			}
		}
        
        if (item_id > 0 && !$.isEmptyObject(spec_goods_price)) {
            var item_arr = [];
            $.each(spec_goods_price, function (i, o) {
                item_arr.push(o.item_id);

            })
            //规格id不存在商品里
            if ($.inArray(parseInt(item_id), item_arr) < 0) {
                initFirstSpec();
            } else {
                $.each(spec_goods_price, function (i, o) {
                    if (o.item_id == item_id) {
                        var spec_key_arr = o.key.split("_");
                        $.each(spec_key_arr, function (index, item) {
                            var spec_radio = $("#goods_spec_" + item);
                            var goods_spec_a = $("#goods_spec_a_" + item);
                            spec_radio.attr("checked", "checked");
                            goods_spec_a.addClass('red');
                        })
                    }
                })
            }
        } else {
            initFirstSpec();
        }
    }
    function initFirstSpec(){
        $('.choicsel').each(function (i, o) {
            var firstSpecRadio = $(this).find("input[type='radio']").eq(0);
            firstSpecRadio.attr('checked','checked');
            firstSpecRadio.parents('.choic-sel').find('a').eq(0).addClass('red');
        })
    }
    //初始化商品价格库存
    function initGoodsPrice() {
        var goods_id = $('input[name="goods_id"]').val();
        if (!$.isEmptyObject(spec_goods_price)) {
            var goods_spec_arr = [];
            $("input[name^='goods_spec']").each(function () {
                if($(this).attr('checked') == 'checked'){
                    goods_spec_arr.push($(this).val());
                }
            });
            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            if (spec_goods_price[spec_key] != undefined){
                var item_id = spec_goods_price[spec_key]['item_id'];
                $('input[name=item_id]').val(item_id);
				if (spec_goods_price[spec_key]['prom_id'] > 0) {
					$('#activity-prom-goods').show();
				} else {
					$('#activity-prom-goods').hide();
				}
            }else{
                $(".goods_price").html(0); //变动价格显示
                $('.spec_store_count').html(0);
                $("#goods_price").html(0); //变动价格显示
                $("#price").html(0); //变动价格显示
                $('#spec_store_count').html(0);
                joinCart(false);
                return false;
            }
        }
        $.ajax({
            type: 'post',
            dataType: 'json',
            data: {goods_id: goods_id, item_id: item_id},
            url: "{:U('Mobile/Goods/activity')}",
            success: function (data) {
                $('#btnbox').show()
                if (data.status == 1) {
                    $('#kanjia_store_count').find('em').text(data.result.goods.store_count);
                    $('input[name="goods_prom_type"]').attr('value', data.result.goods.prom_type);//商品活动类型
                    $('input[name="prom_type"]').attr('value', data.result.goods.prom_type);//商品活动类型
                    $('input[name="shop_price"]').attr('value', data.result.goods.shop_price);//商品价格
                    $('input[name="store_count"]').attr('value', data.result.goods.store_count);//商品库存
                    $('input[name="market_price"]').attr('value', data.result.goods.market_price);//商品原价
                    $('input[name="start_time"]').attr('value', data.result.goods.start_time);//活动开始时间
                    $('input[name="end_time"]').attr('value', data.result.goods.end_time);//活动结束时间
                    $('input[name="activity_title"]').attr('value', data.result.goods.activity_title);//活动标题
                    $('input[name="prom_detail"]').attr('value', data.result.goods.prom_detail);//促销详情
                    $('input[name="buy_limit"]').attr('value', data.result.goods.buy_limit);//抢购限购数量
                    $('input[name="activity_is_on"]').attr('value', data.result.goods.activity_is_on);//活动是否正在进行中
                    $('input[name="prom_id"]').attr('value', data.result.goods.prom_id);//商品活动id

                    $('input[name="deposit_price"]').attr('value', data.result.goods.deposit_price);//订金
                    $('input[name="balance_price"]').attr('value', data.result.goods.balance_price);//尾款
                    $('input[name="ing_amount"]').attr('value', data.result.goods.ing_amount);//已预订了多少个

                    $('input[name="end_price"]').attr('value', data.result.goods.end_price);//砍价享价格
                    $('input[name="goods_store_count"]').attr('value', data.result.goods.goods_store_count);//单独购商品库存

                    if(data.result.goods.prom_type == 8 && data.result.goods['bargain']){
//                        surplus_store_count
                        $('#kanjia_store_count').find('em').text(data.result.goods.surplus_store_count);
                        var buy_now = $('#buy_now').attr('data-id');
                        if(buy_or_join == 0 || activity_button == 0){
                            //$('input[name="goods_prom_type"]').attr('value', 0);//商品活动类型
                            //$('input[name="prom_id"]').attr('value',0);//活动Id
                            $('input[name="shop_price"]').attr('value', data.result.goods.market_price);//商品价格
                            $('input[name="store_count"]').attr('value', data.result.goods.goods_store_count);//商品库存

                        }
                        //砍价
                        bargainList(data.result.goods);
                    }
                    goods_activity_theme();
                    buy_button();
                }
                ajaxDispatching();
            }
        });
    }
    //点击收藏商品
    $(function () {
        $(document).on("click", '#favorite', function (e) {
            var goods_id = $(this).attr('data-goods-id');
            $.ajax({
                type: "GET",
                dataType: "json",
                url: "/index.php?m=Home&c=goods&a=collect_goods&goods_id=" + goods_id,//+tab,
                success: function (data) {
                    // layer.open({content: data.msg, time: 2});
                    if (data.status == '1') { 
                        //收藏点亮
                        $('.shoucang').addClass('shoucang-1');
                        $('.alter-shoucan-1').show();
                        $('.alter-shoucan-1').find('img').show();
                        $('.alter-an').children('.p-1').children('p').text(data.msg)
                    }else{
                        $('.shoucang').removeClass('shoucang-1');
                        $('.alter-shoucan-1').find('img').hide()
                        $('.alter-shoucan-1').show();
                        $('.alter-an').children('.p-1').children('p').text(data.msg)
                    }
                }
            });
            if(!$('alter-shoucan-1').is(':hidden')){
                setTimeout(function(){
                $('.alter-shoucan-1').fadeOut();
                },2000);
            }
        })
       
    })

    //将选择的属性添加到已选
    function sel() {
        var residuenum = parseInt($('.buyNum').attr('residuenum'));
        var title = '';
        $('.choicsel').find('a').each(function (i, o) {   //获取已选择的属性，规格
            if ($(o).hasClass('red')) {
                title += $(o).attr('title') + '&nbsp;&nbsp;';
            }
        })
        var num = $('.buyNum').val();
        if (num > residuenum) {
            num = residuenum;
        }
        var sel = title + '&nbsp;&nbsp;' + num + '件';
        $('.sel').html(sel);
    }

    //ajax请求购物车列表
    function ajax_header_cart(){
        var cart_cn = getCookie('cn');
        if (cart_cn == '') {
            $.ajax({
                type: "GET",
                url: "/index.php?m=Mobile&c=Cart&a=index",//+tab,
                success: function (data) {
                    cart_cn = getCookie('cn');
                    $('#tp_cart_info').html(cart_cn);
                }
            });
        }
        $('#tp_cart_info').html(cart_cn);
    }

    /**
     * 已选
     */
    $('.choise_num').click(function () {
        var goods_prom_type = parseInt($('input[name="goods_prom_type"]').attr('value'));
        if (goods_prom_type == 8) {
            var id = $(this).parent().attr('id');
			//设置是点了购物车还是立即购买
			if(id == 'buy_now_li'){
				$('#buy_now').attr('data-id',1);
				$('#join_cart').attr('data-id',0);
			}else if(id == 'join_cart_li'){
				$('#buy_now').attr('data-id',0);
				$('#join_cart').attr('data-id',1);
			}
            //设置进入选规格页面时，是不是点击活动按钮进的，是左边还是右边按钮
            if(id == 'buy_now_li'){
                buy_or_join = 1;
            }else if(id == 'join_cart_li'){
                buy_or_join = 0;
            }
			if ($(this).find('em').html() == '砍价拿' || ($(this).find('em').html() == '单独购')) {
				activity_button = 1;
			} else {
				activity_button = 0;
			}
        }
		buy_button();
        cover();
        $('.choose_shop_aready').show();
        $('.podee').hide();
		initGoodsPrice()
    })

    //关闭属性选择
    $('.xxgro').click(function () {
        //只有砍价适用 s
		activity_button = -1;
		buy_or_join = -1;
        $("input[name='goods_prom_type']").val($("input[name='prom_type']").val());
        if($("input[name='prom_type']").val() == 8){
            initGoodsPrice();
        }
        //只有砍价适用 e
        undercover();
        $('.choose_shop_aready').hide();
        $('.podee').show();
        sel();
    })
    /**
     * 规格选择
     */
    $('.choic-sel a').click(function () {
        //切换选择
        $(this).addClass('red').parent().siblings().find('a').removeClass('red');
    });
    /**
     * 顶部导航切换
     */
    // 商品跳转事件
    $('#topcenter>span').eq(0).on('click',function () {
        $('.all-yanshi').show();  //全部出头部目录和详情
        $('.xq_details').show();  //商品
        $('.sjs-pinjias').hide().siblings('.tab-con-wrapper').show();  //评价
        $('.hide-ajsk').show();   //评价顶部模块
        $('.shou-hieh').show();   //详情模块
        $('.hide-jsadh').show();  //进入店铺
        $(this).addClass('sxp').siblings().removeClass('sxp');
        $('body,html').stop().animate({scrollTop:0},300);
    })
     // 详情跳转事件
     $('#topcenter>span').eq(1).on('click',function () {
        var a = $('#topcenter>span').index(this);
        $('.xq_details').eq(1).show().siblings('.xq_details').hide();
        $('.all-yanshi').show();  //全部出头部目录和详情
        $('.xq_details').show();  //商品
        $('.sjs-pinjias').hide().siblings('.tab-con-wrapper').show();;  //评价
        $('.hide-ajsk').show();   //评价顶部模块
        $('.shou-hieh').show();   //详情模块
        $('.hide-jsadh').show();  //进入店铺
        var desxq = $('.shou-hieh').offset().top;
        $(this).addClass('sxp').siblings().removeClass('sxp');
        $('body,html').stop().animate({scrollTop:desxq},300);
    })
    // 评论跳转事件
    $('#topcenter>span').eq(2).on('click',function () {
        var h1 = $('.pinlun-des').offset().top;
        $('.all-yanshi').show();  //全部出头部目录和详情
        $('.xq_details').show();  //商品
        $('.sjs-pinjias').show().siblings('.tab-con-wrapper').hide();;  //评价
        $('.hide-ajsk').hide();   //评价顶部模块
        $('.shou-hieh').hide();   //详情模块
        $('.hide-jsadh').hide();  //进入店铺
        $(this).addClass('sxp').siblings().removeClass('sxp');
    })
     // 评论跳转事件
     $('.pinjia-ans').on('click',function () {
        var h1 = $('.pinlun-des').offset().top;
        $('.all-yanshi').show();  //全部出头部目录和详情
        $('.xq_details').show();  //商品
        $('.sjs-pinjias').show().siblings('.tab-con-wrapper').hide();;  //评价
        $('.hide-ajsk').hide();   //评价顶部模块
        $('.shou-hieh').hide();   //详情模块
        $('.hide-jsadh').hide();  //进入店铺
        $(this).addClass('sxp').siblings().removeClass('sxp');
    })
   
   

    /**
     * 内部导航切换
     */
    $('.spxq-ggcs ul li').click(function () {
        $(this).addClass('red').siblings().removeClass('red');
        var sg = $(this).index();
        $('.sg').eq(sg).show().siblings('.sg').hide();
        var $commentType = $(this).children('span').attr('ctype');
        //切换到评论按钮才加载评论列表
        if ($('.detail .search span').eq(2).hasClass('sxp')) {
            ajaxComment($commentType, 1);// ajax 加载评价列表
        }
    });

    //查看商品详情
    function seedeadei(obj){
        $('.xq_details').eq(1).show(); //显示详情
        $('.xq_details').eq(0).hide();
        $('.xq_details').eq(2).hide();
        $(obj).parent('div').hide();
        $('body').animate({'scrollTop': 0}, 0);
        $('#topcenter').html('<span>图文详情</span>');
        $('.detail').find('.center').find('span').eq(1).addClass('sxp');
        $('.detail').find('.center').find('span').eq(0).removeClass('sxp');
        $('#topup').attr('onclick',"topup()");
    }

    //详情下的返回按钮
    function topup(){
        $('.xq_details').eq(0).show(); //显示详情
        $('.xq_details').eq(1).hide();
        $('.xq_details').eq(2).show();
        $('#seedetail').show();
        $('html,body').animate({'scrollTop':0},600)
        $('#topcenter').html('<span class="sxp">商品</span><span>详情</span><span>评论</span>');
        $('#topup').attr('onclick',"$('html,body').animate({'scrollTop':0},600)");
    }
    //完
    /**
     * 加载更多评论
     */
    function ajaxComment(commentType, page) {
        $.ajax({
            type: "GET",
            url: "/index.php?m=Mobile&c=goods&a=ajaxComment&goods_id={$goods['goods_id']}&commentType=" + commentType + "&p=" + page,//+tab,
            // data: {null:2},
            success: function (data) {
                $(".my_comment_list").empty().append(data);
            }
        });
    }
  

    //切换规格
    function switch_spec(spec) {
        $(spec).siblings().removeClass('hover');
        $(spec).addClass('hover');
        $(spec).parent().parent().find('input').removeAttr('checked');
        $(spec).children('input').attr('checked', 'checked');
        $('.team-pies').hide();
        //商品价格库存显示
        initGoodsPrice();
    }

    //商品价格库存显示
    function goods_activity_theme(){
        $('.pre_sell_div').hide();
        var goods_prom_type = $('input[name="goods_prom_type"]').attr('value');
        var activity_is_on = $('input[name="activity_is_on"]').attr('value');
        var is_virtual = $('input[name="is_virtual"]').attr('value');
        if(activity_is_on == 0){
            setNormalGoodsPrice();
        }else {
            if (goods_prom_type == 0) {
                //普通商品
                setNormalGoodsPrice();
            } else if (goods_prom_type == 1) {
                //抢购
                setFlashSaleGoodsPrice();
            } else if (goods_prom_type == 2) {
                //团购
                setGroupByGoodsPrice();
            } else if (goods_prom_type == 3) {
                //优惠促销
                setPromGoodsPrice();
            } else if(goods_prom_type == 4){
                //预售
                setPreSellGoodsPrice();
            } else if(goods_prom_type == 6) {
                //拼团
                $('.team-pies').show();
                var prom_id = $('input[name="prom_id"]').attr('value');
                var goods_id = $('input[name="goods_id"]').attr('value');
                $('.team_button').attr('href',"/index.php?m=Mobile&c=Team&a=info&team_id="+prom_id+"&goods_id="+goods_id);
                setNormalGoodsPrice();
            } else if (goods_prom_type == 8){
                setBargainByGoodsPrice();
            } else {

            }
        }
        
        if(is_virtual == 1){
            $('.buy_limit').show();
        }else{
            $('.buy_limit').hide();
        }
        var store = $('#spec_store_count').html();//实际库存数量
        $('#number').attr('residuenum',store);
        if(store<=0){
            joinCart(false)
        }else if (can_delivery) {
            joinCart(true)
        }
        if(store<=0){
            $('.buyNum').val(store);
        }else{
            $('.buyNum').val(1);
        }
    }
    //普通商品库存和价格
    function setNormalGoodsPrice() {
        var goods_price = $("input[name='shop_price']").attr('value');// 商品本店价
        var market_price =  $("input[name='market_price']").attr('value');// 商品市场价
        var store_count = $("input[name='store_count']").attr('value');// 商品库存
        var exchange_integral = $("input[name='exchange_integral']").attr('value');// 兑换积分
        var point_rate = $("input[name='point_rate']").attr('value');// 积分金额比
        // 如果有属性选择项
        if (!$.isEmptyObject(spec_goods_price)) {
            var goods_spec_arr = [];
            $("input[name^='goods_spec']").each(function () {
                if($(this).attr('checked') == 'checked'){
                    goods_spec_arr.push($(this).val());
                }
            });
            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            goods_price = spec_goods_price[spec_key]['price']; // 找到对应规格的价格
            store_count = spec_goods_price[spec_key]['store_count']; // 找到对应规格的库存
        }
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        if (goods_num > store_count) {
            goods_num = store_count;
            $("#goods_num").val(goods_num);
        }
        var integral = round(goods_price - (exchange_integral / point_rate),2);
        if(exchange_integral > 0){
            $("#goods_price").html(integral + '+' +exchange_integral + '积分'); //变动价格显示
            $("#price").html("<em>￥</em>" + integral + '+' +exchange_integral + '积分'); //积分显示
        }else{
            $("#goods_price").html(goods_price); //变动价格显示
            $("#price").html("<em>￥</em>" + goods_price); //变动价格显示
        }
        $('#market_price_title').html('市场价：');
        $('#spec_store_count').html(store_count);
        $('#number').attr('max', store_count);
        $('.spec_store_count').html(store_count);
        $('.presale-time').hide();

        //隐藏砍价信息
        $('#kanjia_t').hide();//显示时间
        $('#kanjia').hide();//显示参与砍价人数
        $('#kanjia_store_count').hide();
    }

    //预售商品库存和价格
    function setPreSellGoodsPrice(){
        var pre_sale_price = $("input[name='shop_price']").attr('value');//预售价
        var pre_sale_count = $("input[name='store_count']").attr('value');//预售库存
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        var deposit_price = $("input[name='deposit_price']").attr('value');
        var balance_price = $("input[name='balance_price']").attr('value');
        var market_price = $("input[name='market_price']").attr('value');
        if (goods_num > pre_sale_count) {
            goods_num = pre_sale_count;
            $("#goods_num").val(goods_num);
        }
        $('#number').attr('max', pre_sale_count);
        $("#goods_price").html(pre_sale_price); //变动价格显示
        $("#price").html("<em>预售价￥</em>" + pre_sale_price); //变动价格显示
        $('#market_price_title').html('原价：');
        $('#activity_type').html('预售');
        $('#spec_store_count').html(pre_sale_count);
        $('.spec_store_count').html(pre_sale_count);
        $('.presale-time').show();
        $('#deposit_price').html('￥'+deposit_price);
        $('#balance_price').html('￥'+balance_price);
        $('#market_price').empty().html(market_price);
        setInterval(activityTime, 1000);
    }
    //砍价商品库存和价格
    function setBargainByGoodsPrice() {
		if (buy_or_join != 0 && activity_button != 0) {
			var group_by_price = $("input[name='end_price']").attr('value');
		} else {
			var group_by_price = $("input[name='shop_price']").attr('value');
		}
        var group_by_count = $("input[name='store_count']").attr('value');
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        if (goods_num > group_by_count) {
            goods_num = group_by_count;
//            layer.open({content:'库存仅剩 ' + group_by_count + ' 件',time: 2});
            $("#goods_num").val(goods_num);
        }
        $('#number').attr('max', group_by_count);
        $("#goods_price").html(group_by_price); //变动价格显示
        var html = "<em style='padding: .14rem .4rem;background: #ff5252;color: #fffafa;font-size: .5rem;border-radius: 1rem;'>砍价享</em>"+"<em style='vertical-align: middle;font-weight: bold;font-size: .9rem';>￥"+group_by_price+"</em>";
        $("#price").html(html); //变动价格显示
        $('#market_price_title').html('原价：');
        $('#spec_store_count').html(group_by_count);
        $('.spec_store_count').html(group_by_count);
        $('#kanjia_t').show();//显示时间
        $('#kanjia').show();//显示参与砍价人数
        $('#kanjia_store_count').show();
        $('#coupon').hide();//隐藏优惠券
        setInterval(kanjiaTime, 1000);//调用时间
    }
    //秒杀商品库存和价格
    function setFlashSaleGoodsPrice() {
        var flash_sale_price = $("input[name='shop_price']").attr('value');
        var flash_sale_count = $("input[name='store_count']").attr('value');
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        var buy_limit = parseInt($("input[name='buy_limit']").attr('value'));
        if (goods_num > flash_sale_count) {
            goods_num = flash_sale_count;
//            layer.open({content:'库存仅剩 ' + flash_sale_count + ' 件',time: 2});
            $("#goods_num").val(goods_num);
        }
        $('#number').attr('max', flash_sale_count);
        $("#goods_price").html(flash_sale_price); //变动价格显示
        $("#price").html("<em>抢购价</em>" + "<span class='symbol'>￥</span>" + flash_sale_price); //变动价格显示
        $('#market_price_title').html('原价：');
        $('#activity_type').html('限时抢购');
        $('#spec_store_count').html(flash_sale_count);
        $('.spec_store_count').html(flash_sale_count);
        $('.buy_limit').show().html('限购：'+buy_limit);
        $('.presale-time').show();
        setInterval(activityTime, 1000);
    }
    //团购商品库存和价格
    function setGroupByGoodsPrice() {
        var group_by_price = $("input[name='shop_price']").attr('value');
        var group_by_count = $("input[name='store_count']").attr('value');
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        if (goods_num > group_by_count) {
            goods_num = group_by_count;
            $("#goods_num").val(goods_num);
        }
        $('#number').attr('max', group_by_count);
        $("#goods_price").html(group_by_price); //变动价格显示
        $("#price").html("<em>团购价</em>" + "<span class='symbol'>￥</span>" + group_by_price); //变动价格显示
        $('#market_price_title').html('原价：');
        $('#activity_type').html('限时团购');
        $('#spec_store_count').html(group_by_count);
        $('.spec_store_count').html(group_by_count);
        $('.presale-time').show();
        setInterval(activityTime, 1000);
    }
    //活动商品库存和价格
    function setPromGoodsPrice() {
        var prom_goods_price = $("input[name='shop_price']").attr('value');
        var prom_goods_count = $("input[name='store_count']").attr('value');
        var goods_num = parseInt($("input[name='goods_num']").attr('value'));
        if (goods_num > prom_goods_count) {
            goods_num = prom_goods_count;
//            layer.open({content:'库存仅剩 ' + prom_goods_count + ' 件',time: 2});
            $("#goods_num").val(goods_num);
        }
        $('#number').attr('max', prom_goods_count);
        $("#goods_price").html(prom_goods_price); //变动价格显示
        $("#price").html("<em>促销价￥</em>" + prom_goods_price); //变动价格显示
        $('#market_price_title').html('原价：');
        $('#activity_type').html('促销');
        $('#spec_store_count').html(prom_goods_count);
        $('.spec_store_count').html(prom_goods_count);
        $('.presale-time').show();
         setInterval(activityTime, 1000);
    }

    
    // 倒计时
    activityTime();
    function activityTime() {
        var end_time = parseInt($("input[name='end_time']").attr('value'));
        var timestamp = Date.parse(new Date());
        var now = timestamp/1000;
        var end_time_date = formatDate(end_time*1000);
        var text = GetRTime(end_time_date);
        //活动时间到了就刷新页面重新载入
        if(now > end_time){
            layer.open({content:'该商品活动已结束',time: 2});
            location.reload();
        }
        $("#overTime").text(text);
    }
    /**
     * 砍价模块倒计时
     * */
    function kanjiaGetRTime(end_time){
        var NowTime = new Date();
        var t = (end_time*1000) - NowTime.getTime();
        var d = Math.floor(t/1000/60/60/24);
        var h = Math.floor(t/1000/60/60%24)<10?'0' + Math.floor(t/1000/60/60%24):Math.floor(t/1000/60/60%24);
        var m = Math.floor(t/1000/60%60)<10?'0' + Math.floor(t/1000/60%60):Math.floor(t/1000/60%60);
        var s = Math.floor(t/1000%60)<10?'0' + Math.floor(t/1000%60):Math.floor(t/1000%60);
        if(s >= 0)
            return d + '天' + h + ':' + m + ':' +s+'';
    }
    // 砍价倒计时
    function kanjiaTime() {
        var end_time = parseInt($("input[name='end_time']").attr('value'));
        var timestamp = Date.parse(new Date());
        var now = timestamp/1000;
        // var end_time_date = formatDate(end_time*1000);
        var text = kanjiaGetRTime(end_time);
        //活动时间到了就刷新页面重新载入
        if(now > end_time){
            layer.open({content:'该商品活动已结束',time: 2});
            location.reload();
        }
        $("#kanjia_time").find('em').text(text);
    }
    //发起砍价
    function add_cut(){
        var bargain_id = parseInt($("input[name='prom_id']").val());
        var goods_num = parseInt($("input[name='goods_num']").val());
        var item_id = parseInt($("input[name='item_id']").val());
        //询问框
        layer.open({
            content: '确认发起砍价？？'
            ,btn: ['确认', '取消']
            ,yes: function(index){
                $.ajax({
                    type : "POST",
                    dataType: "json",
                    url:"/index.php?m=mobile&c=Bargain&a=start_bargain",//+tab,
                    data: {bargain_id:bargain_id,goods_num:goods_num,item_id:item_id},
                    success: function(data){
                        if(data.status == 1){
                            var url = '?id='+data.result.id;
                            location.href = "{:U('Bargain/index')}"+url;
                        }else if(data.status <0){
                            window.location.href = "{:U('Mobile/User/login')}";
                            return;
                        }else{
                            layer.open({content:data.msg, time:2});
                        }
                    }
                });
            }
        });

    }
    //遍历
    function bargainList(data) {
        var html = '';
        $.each(data.bargain_list,function (i,o) {
            if(i == 6){return false;}
                html+='<img src="'+o.head_pic+'" style="width: 1rem;height:1rem;margin-left: -10px;border-radius: 50%;border:4px #fff solid ">';

        })
        // 1285人正在参加
        var list_count = Number(data.bargain.virtual_num) + Number(data.bargain_list.length);
        if(list_count >=10000){
            list_count = (list_count / 10000).toFixed(1)+'万';
        }
        $('#kanjia_num').html(list_count+'人正在参加');
		//虚拟人物头像
            var photo = [
                'https://ss0.bdstatic.com/70cFuHSh_Q1YnxGkpoWK1HF6hhy/it/u=1091628847,41930541&fm=27&gp=0.jpg',
                'https://ss3.bdstatic.com/70cFv8Sh_Q1YnxGkpoWK1HF6hhy/it/u=1285622578,302277335&fm=27&gp=0.jpg',
                'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3893578947,513342183&fm=27&gp=0.jpg',
                'https://ss1.bdstatic.com/70cFvXSh_Q1YnxGkpoWK1HF6hhy/it/u=1880698741,2631508258&fm=27&gp=0.jpg',
                'https://ss2.bdstatic.com/70cFvnSh_Q1YnxGkpoWK1HF6hhy/it/u=3859421672,511986628&fm=200&gp=0.jpg',
				'https://gss0.bdstatic.com/6LZ1dD3d1sgCo2Kml5_Y_D3/sys/portrait/item/7794e894bae699a8e59190ec30?t=1556897371'
            ];
        if(data.bargain_list.length < 6){
            if(Number(data.bargain.virtual_num) + Number(data.bargain_list.length) >=6){
                var le = 6 - data.bargain_list.length;
            }else{
                var le = data.bargain.virtual_num;
            }
            for (var i=0;i<le;i++){
                html+='<img src="'+photo[i]+'" style="width:1rem;height:1rem;margin-left: -10px;border-radius: 50%;border:4px #fff solid ">';
            }
        }

        $('#kanjia_list').html(html);

    }
    //时间戳转换
    function add0(m){return m<10?'0'+m:m }
    function formatDate(now){
        var time = new Date(now);
        var y = time.getFullYear();
        var m = time.getMonth()+1;
        var d = time.getDate();
        var h = time.getHours();
        var mm = time.getMinutes();
        var s = time.getSeconds();
        return y+'/'+add0(m)+'/'+add0(d)+' '+add0(h)+':'+add0(mm)+':'+add0(s);
    }

    function sortNumber(a, b) {
        return a - b;
    }
    //运费
    $(function () {
        $('.remain').click(function () {
            $('#balance').toggle(300);
        })
        $('#balance').on('click', 'a', function () {
            $('#shipping_freight').text($(this).find('span').text());
            $('#balance').toggle(300);
        })
    })
    /**
     * 点赞ajax
     * dyr
     * @param obj
     */
    function zan(obj) {
        var user_id = getCookie('user_id');
        if (user_id == '') {
            layer.open({content:'请先登录',time:2});
            return ;
        }
        var comment_id = $(obj).attr('data-comment-id');
        var zan_num = parseInt($("#span_zan_" + comment_id).text());
        $.ajax({
            type: "POST",
            data: {comment_id: comment_id},
            dataType: 'json',
            url: "/index.php?m=Mobile&c=Order&a=ajaxZan",
            success: function (data) {
                if (data.status == 1) {
                    $("#span_zan_" + comment_id).text(zan_num + 1);
                    $('#'+comment_id).find('.like').addClass('like_ani'); //显示点赞效果
                    $('#'+comment_id).find('.btn-like-icon').addClass('like-red');
                } else {
                    $('.alert').show(200);
                    $('.alert').animate({opacity:"1"},600,hde());
                }
            },
            error : function(res) {
                if( res.status == "200"){ // 兼容调试时301/302重定向导致触发error的问题
                    layer.open({content:'请先登录!',time:2})
                    return;
                }
                layer.open({content:'请求失败!',time:2})
                return;
            }
        });
    }
    //轮播
    $(function(){
        $('#slideTpshop').swipeSlide({
            continuousScroll:true,
            speed : 3000,
            transitionType : 'cubic-bezier(0.22, 0.69, 0.72, 0.88)',
            firstCallback : function(i,sum,me){
                me.find('.dot').children().first().addClass('cur');
            },
            callback : function(i,sum,me){
                me.find('.dot').children().eq(i).addClass('cur').siblings().removeClass('cur');
            }
        });
        //圆点
        var ed = $('.mslide ul li').length - 2;
        $('.mslide').append("<div class=" + "dot" + "></div>");
        for(var i = 0; i<ed ;i++){
            $('.mslide .dot').append("<span></span>");
        };
        $('.mslide .dot span:first').addClass('cur');
        var wid = - ($('.mslide .dot').width() / 2);
        $('.mslide .dot').css('position','absolute').css('left','50%').css('margin-left',wid);

        //购物车数量大于0才显示数量start
        function change(){
            var count=document.getElementById("tp_cart_info").innerText;
            if(count==0){
                $("#tp_cart_info").css({"display":"none"});
            }else{
                $("#tp_cart_info").css({"display":"block"});
            }
        }
        var number=setInterval(function(){
            change();
        },1000)
        //购物车数量大于0才显示数量end

    });
</script>

<script src="__PUBLIC__/js/jqueryUrlGet.js"></script><!--获取get参数插件-->
<script> set_first_leader(); //设置推荐人 </script>
<include file="public/wx_share"/>
</body>
</html>
