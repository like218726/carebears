<include file="public/header" title="{$team[share_title]}"/>
<link rel="stylesheet" href="__STATIC__/css/shopdes.css"/>
<link rel="stylesheet" href="__STATIC__/css/team.css"/>
<style>
    body{
        padding-top: 0;
    }
</style>


<!-- 正在拼单弹框开始 -->
<div class="zzpd_mark">
    <div class="zzpd_mark_box">
        <div class="zzpd_title">
            正在拼单
        </div>
        <div class="zzpd_close"></div>
        <div class="zzpd_mark_list">
            <ul id="more-team">
                <volist name="team_found_list" id="vo">
                    <li>
                        <img src="{$vo.head_pic}" alt="__STATIC__/images/zzpd_img.png">
                        <p><span>{$vo.nickname}&nbsp;&nbsp;还差{$vo.need-$vo.join}人</span><span class="team_end_time">剩余23:38:03</span></p>
                        <span class="btn" onclick="go_team(this)" team_id="{$vo.team_id}" found_id="{$vo.found_id}">去拼单</span>
                    </li>
                </volist>
            </ul>
        </div>
    </div>
</div>
<notempty name="team_found_list">
    <input type="hidden" id="found_end_time" value="{$team_found_list[0]['found_end_time']}">
</notempty>

<script type="text/javascript">
    $(function(){
        $(document).on("click",'.zzpd_close', function(){
            $('.zzpd_mark').hide(300);
        })
        $(document).on("click", ".zzpd_more", function () {
            $('.zzpd_mark').show(300);
        })
    });
</script>


<!-- 正在拼单弹框结束 -->

<div class="he_sustain">
    <div class="classreturn loginsignup detail">
        <div class="content">
            <div class="ds-in-bl return">
                <a href="javascript:history.back(-1)"><img src="__STATIC__/images/return.png" alt="返回"></a>
            </div>
            <div class="ds-in-bl search center" id="topcenter">
                <span class="sxp">商品</span>
                <span>详情</span>
                <span>评论</span>
            </div>
        </div>
    </div>
</div>
<!--顶部隐藏菜单-s-->
<include file="public/top_nav"/>
<!--顶部隐藏菜单-e-->
<div class="xq_details action-detail">
    <div class="banner ban1 detailban">
        <div class="mslide" id="slideTpshop">
            <ul>
                <foreach name="team_activity['goods']['goods_images']" item="pic">
                    <li><a href="javascript:void(0)"><img src="{$pic[image_url]}"></a></li>
                </foreach>
            </ul>
            <a class="attengro front_status_desc">{$team_activity.front_status_desc}</a>
        </div>
        <!--
        <div class="jump-message">
            <div class="litsbe">
                <div class="yigsmrecan">
                    <img class="juminm" src="../images/mq.jpg"/>
							<span class="juminn">
								最新订单来自重庆的<em class="jumname">美沁</em>,<em>1</em>秒前
							</span>
                </div>
            </div>
        </div>
        -->
    </div>
    <!-- 头部轮播、文字 -->
    <div class="de_font p">
        <div class="thirty">
            <div style="width: 100%;" class="fl">
                <span class="similar-product-text">{$team_activity[goods_name]}</span>
                <p class="red fl" style="width:12.288rem;display: none;" id="price"><em>￥</em>100.00</p>
                <div class="keep fr">
                    <a href="javascript:;">
                        <i class=""></i>
                        <span>分享</span>
                    </a>
                </div>
            </div>
            <div class="scunde p">
                <p class="shdicc share_desc">{$team_activity.share_desc}</p>
                <p class="red meny">￥<span class="team_price">{$team_activity['team_goods_item'][0]['team_price']}</span></p>
                <p class="shdicc meny">市场价格：<span class="linethr">{$team_activity.goods.market_price}</span></p>
            </div>
        </div>
    </div>
    <div class="floor list7 g4">
        <!-- 质量版块s -->
        <div class="myhearders myorder actino-her ma-to-20" style="height: 1.92rem;">
            <div class="scgz descgz">
                <ul>
                    <li>
                        <a href="javascript:void(0);">
                            <img src="__STATIC__/images/ag.png">

                            <p>品质保障</p>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);">
                            <img src="__STATIC__/images/ah.png">

                            <p>放心物流</p>
                        </a>
                    </li>
                    <li>
                        <a href="javascript:void(0);">
                            <img src="__STATIC__/images/ai.png">

                            <p>贴心服务</p>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="yixgp have_founds" style="display: none">
            <div class="maleri30">
                <span>以下小伙伴正在发起团购，您可以直接参与</span>
            </div>
        </div>
        <div class="lesgcan have_founds" style="display: none">
            <div class="maleri30" id="found_list">
            </div>
        </div>
        <!-- 拼团规则 -->
        <div class="shartogete ma-to-20">
            <div class="maleri30">
                <h2>拼团规则</h2>
                <ul class="forneu">
                    <li>
                        <span class="aroundu">1</span>
                        <span>选择商品</span>
                    </li>
                    <li>
                        <span class="aroundu">2</span>
                        <span>开团/参团</span>
                    </li>
                    <li>
                        <span class="aroundu">3</span>
                        <span>邀请好友</span>
                    </li>
                    <li>
                        <span class="aroundu">4</span>
                        <span>人满成团</span>
                    </li>
                </ul>
                <p class="fohe"><i class="action-al"></i></p>
            </div>
        </div>
        <div class="hs_acion">
            <div class="maleri30">
                <p>1.开团：在商城内选择喜欢的商品，点击“去开团”，付款成功后即为开团成功；</p>

                <p>2.参团：进入朋友分享的页面，点击“立即参团”，付款后即为参团成功，若多人同时支付，按先支付成功的用户获得参团资格；</p>

                <p>3.成团：在开团或参团之后,可以点击“分享出去”，在有效时间凑齐成团人数即拼团成功；</p>

                <p>4.组团失败：在有效时间内未凑齐人数，即为组团失败，此时商城会将原款分别退回；</p>
            </div>
        </div>
        <!-- 进店逛逛 -->
        <div class="storespe ma-to-20">
            <div class="maleri30 clearfix">
                <div class="spelee">
                    <img src="{$store[store_logo]}"/>
                </div>
                <div class="nxnan">
                    <h2>{$store[store_name]}</h2>

                    <p><span>销量：</span><span>{$team_activity[sales_sum]+$team_activity[virtual_num]}</span></p>
                </div>
                <a class="home_man" href="{:U('Store/index',array('store_id'=>$goods[store_id]))}"><div class="jindain-guai">进店逛逛</div></a>
            </div>
             <!-- 评价分 -->
             <div style="margin: 0.46933rem 0.46933rem 0 0.46933rem;" class="mid_storeme p">
                <ul>
                    <li>
                        <div class="commeaye">
                            <p class="sh_pp"><span>商品评价</span>
                                <?php
                                                $cls=array('高'=>"yuanda-gao",'中'=>"yuanda-zhong",'低'=>"yuanda-di");
                                $store_desccredit=getStoreScoreDec($goods['store']['store_desccredit']);
                                ?>
                                <span class="red"><em>{$goods['store']['store_desccredit']}</em><b class="{$cls[$store_desccredit]}">{$goods['store']['store_desccredit']|getStoreScoreDec}</b></span>

                            </p>
                            <!-- <p class="sh_sz"><span>232</span></p> -->
                            <!-- <p class="sh_ep"><span>销量</span></p> -->
                        </div>
                    </li>
                    <li>
                        <div class="commeaye">
                            <?php $store_servicecredit=getStoreScoreDec($goods['store']['store_servicecredit']);?>
                            <p class="sh_pp"><span>服务评价</span><span class="red"><em>{$goods['store']['store_servicecredit']}</em><b class="{$cls[$store_servicecredit]}">{$goods['store']['store_servicecredit']|getStoreScoreDec}</b></span></p>

                            <!-- <p class="sh_sz"><span>36</span></p> -->
                            <!-- <p class="sh_ep"><span>收藏</span></p> -->
                        </div>
                    </li>
                    <li>
                        <div class="commeaye">
                            <?php $store_deliverycredit=getStoreScoreDec($goods['store']['store_deliverycredit']);?>
                            <p class="sh_pp"><span>物流评价</span><span class="red"><em>{$goods['store']['store_deliverycredit']}</em><b class="{$cls[$store_deliverycredit]}">{$goods['store']['store_deliverycredit']|getStoreScoreDec}</b></span></p>
                            <!-- <p class="sh_sz"><span>0</span></p> -->
                            <!-- <p class="sh_ep"><span>排行</span></p> -->
                        </div>
                    </li>
                </ul>
            </div>
        </div>
        
        <notempty name="team_found_list">
        <div class="ma-to-20 zzpd_box" >
            <div class="zzpd">{:count($team_found_list)}人正在拼单，可直接参与
                <span class="zzpd_more">查看更多</span>
            </div>
            <ul class="zzpd_list">
                <volist name="team_found_list" id="vo">
                    <li>
                        <img src="{$vo.head_pic}" alt="__STATIC__/images/zzpd_img.png">
                        <span class="zzpd_name">{$vo.nickname}</span>
                        <span class="zzpd_btn" onclick="go_team(this)" team_id="{$vo.team_id}" found_id="{$vo.found_id}">去拼单</span>
                        <p class="zzpd_num"><span>还差<i>{$vo.need-$vo.join}人</i>拼成</span><span class="team_end_time">剩余23:38:03</span></p>
                    </li>
                </volist>

            </ul>
        </div>
        </notempty>
        <!-- 评价头部版块 -->
        <div class="myorder p tbv ma-to-20">
            <div class="content30">
                <a href="javascript:void(0)">
                    <div class="order">
                        <div class="fl">
                            <span class="firde">用户评价<i class="yasan-ajdas">({$goods['comment_statistics']['total_sum']})</i></span>
                        </div>
                        <div class="fr">
                            <span style="margin-top: 0;">好评率<i class="red">{$goods['comment_statistics']['high_rate']}%</i></span>
                            <i class="Mright"></i>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>
</div>
<!--评论区-->
<div class="xq_details">
    <div style="display: none;" class="spxq-ggcs comment_de p">
        <ul class="clearfix">
            <!--1 全部 2好评 3 中评 4差评-->
            <li class="red">全部<span ctype="1">{$team_activity['goods']['comment_statistics']['total_sum']}</span></li>
            <li>好评<span ctype="2">{$team_activity['goods']['comment_statistics']['high_sum']}</span></li>
            <li>中评<span ctype="3">{$team_activity['goods']['comment_statistics']['center_sum']}</span></li>
            <li>差评<span ctype="4">{$team_activity['goods']['comment_statistics']['low_sum']}</span></li>
            <li>有图<span ctype="5">{$team_activity['goods']['comment_statistics']['img_sum']}</span></li>
        </ul>
        <div class="tab-con-wrapper my_comment_list"></div>
    </div>
    <div class="tab-con-wrapper my_comment_list"></div>
</div>
<!--评论区-->
<!--详情-s-->
<div class="xq_details">
    <div class="spxq-ggcs">
        <ul>
            <li class="red">商品详情</li>
            <li>规格参数</li>
        </ul>
    </div>
    <div class="sg">
        <div class="spxq p">
            {$team_activity.goods.goods_content|htmlspecialchars_decode}
        </div>
    </div>
    <div class="sg" style="display: none;">
        <div class="spxq p">
            <table class="de_table" border="1" bordercolor="#cbcbcb" style="border-collapse:collapse;">
                <tr>
                    <th colspan="2">主体</th>
                </tr>
                <foreach name="team_activity['goods']['goods_attr']" id="goods_attr">
                    <tr>
                        <td>{$goods_attr['goods_attribute']['attr_name']}</td>
                        <td>{$goods_attr['attr_value']}</td>
                    </tr>
                </foreach>
            </table>
        </div>
    </div>
</div>
<!--详情-e-->
<div class="podee actionfooer">
    <div class="cart-concert-btm p">
        <div class="fl love_sjda">
            <ul>
                <!-- <li>
                    <a href="{:U('Index/index')}">
                        <em class="ico ico-index6"></em>
                        <p>首页</p>
                    </a>
                </li> -->
                <li>
                    <a href="javascript:" data-goods-id="{$team_activity.goods_id}" id="favorite">
                        <em class="ico ico-heart <if condition='$collect gt 0'>ico-heart-h</if>" ></em>
                        <p>收藏</p>
                    </a>
                </li>
                <li>
                    <if condition="(!empty($tpshop_config['basic_im_choose'])) && ($tpshop_config['basic_im_choose'] eq 1)">
                        <!--im客服-->
                        <a class="kf" href="{:U('supplier/index',array('store_id'=>$goods[store_id],'goods_id'=>$goods['goods_id']))}">
                            <em class="ico ico-kf6"></em>
                            <p>客服</p>
                        </a>
                        <elseif condition="(!empty($tpshop_config['basic_im_choose'])) && ($tpshop_config['basic_im_choose'] eq 2)" />
                        <!--小能客服-->
                        <a href="javascript:;">
                            <em class="ico ico-kf6"></em>
                            <p>客服</p>
                        </a>
                        <else />
                        <!--早先客服-->
                        <a href="tel:{$store[service_phone]}">
                            <em class="ico ico-kf6"></em>
                            <p>客服</p>
                        </a>
                    </if>
                </li>
            </ul>
        </div>
        <div class="fr">
            <ul>
                <li class="o">
                    <a href="{:U('Mobile/Goods/goodsInfo',['id'=>$team_activity[goods_id]])}">
                        单独购买<br/>
                        ￥<em>{$team_activity['goods'][shop_price]}</em>
                    </a>
                </li>
                <li class="r lottery" style="display: none">
                    <a href="{:U('Mobile/Team/lottery',['team_id'=>$team_activity['team_id']])}">查看中奖名单
                        <br/>
                        ￥<em class="team_price">{$team_activity['team_goods_item'][0]['team_price']}</em>
                    </a>
                </li>
                <li class="r no_lottery">
                    <a href="javascript:void(0);" class="choise_num">
                        <em>{$team_activity.needer}</em>人团<br/>
                        ￥<em class="team_price">{$team_activity['team_goods_item'][0]['team_price']}</em>
                    </a>
                </li>
            </ul>
        </div>
    </div>
</div>
<!--点赞弹窗-s-->
<div class="alert">
    <img src="__STATIC__/images/hh.png"/>

    <p>您已经赞过了！</p>
</div>
<!--点赞弹窗-e-->

<!-- 收藏弹窗 -->
<div class="alter-shoucan-1">
    <div class="alter-an">
        <div class="p-1">
            <img src="__STATIC__/images/withdraw-cheng.png" alt="">
            <p></p>
        </div>
    </div>
</div>

<!--所选弹窗-s-->
<form name="buy_goods_form" method="post" id="buy_goods_form">
    <input type="hidden" name="goods_id" value="{$team_activity.goods_id}"/>
    <input type="hidden" name="item_id" value="{$Request.param.item_id}"/>
    <input type="hidden" name="spec_goods_price" value='{$team_activity.goods.spec_goods_price|json_encode=true}' disabled>
    <input type="hidden" name="team_id" value="{$team_activity.team_id}" disabled/>
    <input type="hidden" name="is_lottery" value="{$team_activity.is_lottery}" disabled/>
    <div class="choose_shop_aready p" id="choose_spec">
        <div class="shop-top-under p">
            <div class="maleri30">
                <div class="shopprice">
                    <div class="img_or fl"><img src="{$team_activity['goods_id']|goods_thum_images=146,146}"></div>
                    <div class="fon_or fl">
                        <h2 class="similar-product-text">{$team_activity[goods_name]}</h2>

                        <div class="price_or"><span>￥</span><span class="team_price">{$team_activity['team_goods_item'][0]['team_price']}</span>(<span>{$team_activity.needer}</span>人团)<span id="item_front_status_desc">{$team_activity.front_status_desc}</span></div>
                        <div class="dqkc_or"><span>当前库存：</span><span class="stock" id="spec_store_count">{$team_activity.goods.store_count}</span></div>
                    </div>
                    <div class="price_or fr">
                        <i class="xxgro" id="choose_spec_close"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="shop-top-under p">
            <div class="maleri30">
                <div class="shulges p">
                    <p>数量</p>

                    <div class="plus">
                        <span class="mp_minous">-</span>
                        <span class="mp_mp"> <input type="tel" class="num buyNum" id="number" residuenum="{$team_activity.goods.store_count}" name="goods_num" value="1" min="1" max="{$team_activity.goods.store_count}" onblur="altergoodsnum(0)"></span>
                        <span class="mp_plus">+</span>
                    </div>
                </div>
                <volist name="team_activity['goods']['spec']" id="spec">
                    <div class="shulges p choicsel spec">
                        <p>{$spec['name']}</p>
                        <!-------商品属性值-s------->
                        <volist name="spec['spec_item']" id="spec_item">
                            <div class="plus choic-sel">
                                <a id="goods_spec_a_{$spec_item['id']}" class="spec_item" title="{$spec_item['item']}" data-item-id="{$spec_item['id']}"
                                <volist name="team_activity['goods']['spec_image']" id="spec_image">
                                    <if condition="$spec_image['spec_image_id'] eq $spec_item['id']">
                                        data-img-src="{$spec_image['src']}"
                                    </if>
                                </volist>
                                >
                                <input id="goods_spec_{$spec_item['id']}" type="radio" style="display:none;" name="goods_spec[{$spec['name']}]" value="{$spec_item['id']}" disabled/>{$spec_item['item']}</a>
                            </div>
                        </volist>
                        <!-------商品属性值-e-------->
                    </div>
                </volist>
            </div>
        </div>
        <div class="plusshopcar-buy p">
            <a class="pb_buy dis_btn" href="javascript:void(0);" onClick="addTeamOrder();">立即购买</a>
        </div>
    </div>
</form>
<!--所选弹窗-e-->
<!--分享-s-->
<div class="fenxiang_two">
    <img src="__STATIC__/images/share_tips.png" alt="">
</div>
<div class="bg_posters">
    <div class="flex">
        <div class="posters_photo">
            <div class="img">
                <img data-src="{:U('mobile/goods/goodsSharePoster',['id'=>$goods['goods_id']])}" id="src_posters">
            </div>
            <div class="save">
                <p>长按图片后可保存到相册</p>
                <img class="posters_img" src="__STATIC__/images/share_close.png" alt="">
            </div>
        </div>
    </div>
</div>
<div class="fenxiang-1">
    <div class="bg-fenxiang"></div>
    <div class="img-wen">
        <div class="copy_link">
            <img src="__STATIC__/images/share-lj.png" alt="">
            <span>复制链接</span>
        </div>
        <div class="posters">
            <img src="__STATIC__/images/share-posters.png" alt="">
            <span>生成海报</span>
        </div>
        <div class="share_wx">
            <img src="__STATIC__/images/share-wx.png" alt="">
            <span>微信分享</span>
        </div>
    </div>
    <p class="cancel">取消</p>
</div>
<!--分享-e-->
<script>
    //    生成海报
    $('.posters').on('click',function(){
        $('.bg_posters').show();
        $('.fenxiang-1').hide();
        if($("#src_posters").attr('src') == undefined){
            $("#src_posters").attr('src',$("#src_posters").attr('data-src'));
        }
    })
    // 分享功能-s
    $('.keep').on('click',function(){
        $('.fenxiang-1').show();
        console.log(!isWeiXin())
        if(!isWeiXin()){
            $('.share_wx').hide();
        }
    })
    $('.bg-fenxiang').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $('.cancel').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $('.cancel').on('click',function(){
        $('.fenxiang-1').hide();
    })
    $(".copy_link").click(function(){                          //复制当前网页链接
        var user_id = getCookie('user_id'); // 当前用户id
        var is_distribut = getCookie('is_distribut'); // 是否分销代理
        var url = window.location.href;
        // 如果已经登录了, 并且是分销商 拼团分销链接分享
        if(parseInt(is_distribut) == 1 && parseInt(user_id) > 0)
        {
            if(url.indexOf('&')>0){
                url = url + "&first_leader="+user_id;
            }else{
                url = url + "/first_leader/"+user_id;
            }
        }
        var successful;
        if (navigator.userAgent.match(/(iPhone|iPod|iPad|iOS)/i)) { //ios
            var copyDOM = document.createElement('div');  //要复制文字的节点
            copyDOM.innerHTML = url;
            document.body.appendChild(copyDOM);
            var range = document.createRange();
            // 选中需要复制的节点
            range.selectNode(copyDOM);
            // 执行选中元素
            window.getSelection().addRange(range);
            // 执行 copy 操作
            successful = document.execCommand('copy');
            // 移除选中的元素
            window.getSelection().removeAllRanges();
            $(copyDOM).hide()
        }else{
            var oInput = document.createElement('input')
            oInput.value = url;
            document.body.appendChild(oInput)
            oInput.select() // 选择对象
            successful = document.execCommand('Copy') // 执行浏览器复制命令
            oInput.className = 'oInput'
            oInput.style.display = 'none'
            oInput.remove()
        }
        if(successful){
            layer.open({icon: 1, content: "复制成功", time: 2});
            $('.fenxiang-1').hide();
        }else{
            layer.open({icon: 1, content: "复制失败", time: 2});
            $('.fenxiang-1').hide();
        }
    });
    //    生成海报
    $('.posters').on('click',function(){
        $('.bg_posters').show();
        $('.fenxiang-1').hide();
    })
    $('.bg_posters').on('click',function(){
        $('.bg_posters').hide();
    })
    $('.posters_img').on('click',function(){
        $('.bg_posters').hide();
    })
    $('.share_wx').on('click',function(){
        $('.fenxiang_two').show();
        $('.fenxiang-1').hide();
    })
    $('.fenxiang_two').on('click',function(){
        $('.fenxiang_two').hide();
    })
    $(".fenxiang-1").on("touchmove",function(){ 
　　　　event.preventDefault(); 
	});
    // 分享功能-e
</script>
<div class="mask-filter-div" style="display: none;"></div>
<include file="public/wx_share"/>
<script src="__STATIC__/js/style.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
    var form = $("#buy_goods_form");
    var team_id = form.find("input[name='team_id']").val();
    var r_team_id,team_price,needer,is_lottery,front_status_desc,stock,share_title,share_desc,bd_url,bd_pic,lottery_url,time_limit;
    r_team_id = {$Request.param.team_id|default=0};
    var spec_goods_price = $.parseJSON(form.find("input[name='spec_goods_price']").val());//规格库存价格
    var commentType = 1;// 默认评论类型
    $(document).ready(function () {
        initSpec();
        ajaxComment(commentType, 1);// ajax 加载评价列表
        getTeamFounds();
    });
    //有活动id的时候，解析活动id选中规格
    function initSpec() {
        var item_id = form.find("input[name='item_id']").val();
        if (!$.isEmptyObject(spec_goods_price)) {
            $.each(spec_goods_price, function (i, o) {
                if ((item_id > 0 && o.prom_id == item_id) || (team_id == o.prom_id)) {
                    var spec_key_arr = o.key.split("_");
                    $.each(spec_key_arr, function (index, item) {
                        var spec_radio = $("#goods_spec_" + item);
                        var goods_spec_a = $("#goods_spec_a_" + item);
                        spec_radio.attr("checked", "checked");
                        goods_spec_a.addClass('red');
                    })
                    return false;
                }
            })
        }
        dos();
        initGoodsPrice();
    }
    /**
     * 规格选中样式显示
     */
    function dos(){
        var spec_item = $('.spec_item');//所有的 spec_item a标签
        var spec = $('.spec');//整个规格项div
        //若存在规格item 判断是否已经被选中，若已选中不装入数组
        if(spec_item.length > 0){
            var item_id_arr = [];
            spec_item.each(function () {
                //循环所有规格项，将选中的规格项放入item_id_arr数组
                if($(this).hasClass('red')){
                    item_id_arr.unshift($(this).data('item-id'));
                }
            });
            item_id_arr.sort(sortNumber);
            //item_id_arr 为选中的规格id
            var able_item_id_arr = [];
            var spec_arr = [];
            //spec_goods_price 为规格组合的商品唯一的 sku
            $.each(spec_goods_price, function (i, o) {
                if(o.team_id > 0){
                    spec_arr.unshift(o);
                }
            })
            //spec_arr 是存在活动的商品sku
            for (x in item_id_arr)
            {
                $.each(spec_goods_price, function (i, o) {
                    var strs = o.key.split("_");
                    if($.inArray(item_id_arr[x].toString(),strs) != -1 && o.team_id > 0){
                        for (j in strs){
                            if($.inArray(strs[j],able_item_id_arr) == -1){
                                able_item_id_arr.push(strs[j]);
                            }
                        }
                    }
                })
            }

        }
    }
    var addTeamOrder_flag = false;
    //添加评团订单
    function addTeamOrder(){
        if(addTeamOrder_flag) return false;
        var goods_num = $("input[name='goods_num']").val();
        if (goods_num <= 0) {
            layer.open({content:'请至少购买一份~',time: 2});
            return false;
        }
        addTeamOrder_flag = true;
        $.ajax({
            type : "POST",
            url:"{:U('Mobile/Team/addOrder')}",
            dataType:'json',
            data: $('#buy_goods_form').serialize(),
            success: function(data){
                if(data.status == 1){
                    location.href = "/index.php?m=Mobile&c=Team&a=order&order_id=" + data.result.order_id; // 跳转到结算页
                }else{
                    addTeamOrder_flag = false;
                    layer.open({content:data.msg,time: 2,end:function(){
                        if(!$.isEmptyObject(data.result)){
                            if(!$.isEmptyObject(data.result.url)){
                                location.href = data.result.url;
                                return false;
                            }
                        }
                    }});
                }
            }
        });
    }
    /**
     * 加载更多评论
     */
    function ajaxComment(commentType, page) {
        var goods_id = $("input[name='goods_id']").val();
        $.ajax({
            type: "GET",
            url: "/index.php?m=Mobile&c=goods&a=ajaxComment&goods_id=" + goods_id + "&commentType=" + commentType + "&p=" + page,//+tab,
            success: function (data) {
                $(".my_comment_list").empty().append(data);
            }
        });
    }
    $(function () {
        //顶部导航切换
        $('.detail .search span').eq(0).on('click',function () {
            console.log(00)
            $(this).addClass('sxp').siblings().removeClass('sxp');
            $('.xq_details').show();
            $('.comment_de').hide().siblings('.tab-con-wrapper').show();
            $('body,html').stop().animate({scrollTop:0},300);
        })
        $('.detail .search span').eq(1).on('click',function () {
            console.log(22)
            $(this).addClass('sxp').siblings().removeClass('sxp');
            var h1 = $('.detail').height()+$('.xq_details').height()+$('.spxq-ggcs').height();
            $('.xq_details').show();
            $('.comment_de').hide().siblings('.tab-con-wrapper').show();
            $('body,html').stop().animate({scrollTop:h1},300);
        })
        $('.detail .search span').eq(2).on('click',function () {
            console.log(11)
            $(this).addClass('sxp').siblings().removeClass('sxp');
            var a = $('.detail .search span').index(this);
            $('.xq_details').eq(1).show().siblings('.xq_details').hide();
            $('.comment_de').show().siblings('.tab-con-wrapper').hide();
        })
       
    });
    //点击收藏商品
    $(function () {
        $(document).on("click", '#favorite', function (e) {
//            var favorite = $(this);
//            var goods_id = favorite.attr('data-goods-id');
            var goods_id = $(this).attr('data-goods-id');
            $.ajax({
                type: "GET",
                dataType: "json",
                url: "/index.php?m=Home&c=goods&a=collect_goods&goods_id=" + goods_id,//+tab,
                success: function (data) {
                    // layer.open({content: data.msg, time: 2});
                    console.log(data)
                    if (data.status == '1') {
                        //收藏点亮
                        $('.ico-heart').addClass('ico-heart2');
                        $('.alter-shoucan-1').show();
                        $('.alter-shoucan-1').find('img').show();
                        $('.alter-an').children('.p-1').children('p').text(data.msg)
                    }else{
                        $('.ico-heart').removeClass('ico-heart2');
                        $('.alter-shoucan-1').find('img').hide()
                        $('.alter-shoucan-1').show(); 
                        $('.alter-an').children('.p-1').children('p').text(data.msg) 
                    }
                }
            });
            if(!$('alter-shoucan-1').is(':hidden')){
                setTimeout(function(){
                $('.alter-shoucan-1').fadeOut();
                },2000);
            }
        })
    })
    $(function () {
        ////内部导航切换
        $('.spxq-ggcs ul li').click(function () {
            $(this).addClass('red').siblings().removeClass('red');
            var sg = $(this).index();
            $('.sg').eq(sg).show().siblings('.sg').hide()
        });
        var h1 = $('.detail').height()+$('.xq_details').height();
        var h2 = $('.detail').height() + $('.spxq-ggcs').height()+$('.xq_details').height();
        var ss = $(document).scrollTop();//上一次滚轮的高度


        $(window).scroll(function () {
            var s = $(document).scrollTop();////本次滚轮的高度
            if (s < h1) {
                $('.spxq-ggcs').removeClass('po-fi');
                if($('#topcenter>span').index($('#topcenter>span.sxp'))!=0&&!$('body,html').is(':animated')) {
                    if($('#topcenter>span').index($('#topcenter>span.sxp'))!=2) {
                        $('#topcenter>span').eq(0).addClass('sxp').siblings().removeClass('sxp');
                    }
                }
            }
            if (s >= h1) {
                $('.spxq-ggcs').addClass('po-fi');
                if($('#topcenter>span').index($('#topcenter>span.sxp'))!=1&&!$('body,html').is(':animated')) {
                    $('#topcenter>span').eq(1).addClass('sxp').siblings().removeClass('sxp');
                }
            }
            if (s > h2) {
                $('.spxq-ggcs').addClass('gizle');
                if (s > ss) {
                    $('.spxq-ggcs').removeClass('sabit');
                } else {
                    $('.spxq-ggcs').addClass('sabit');
                }
                ss = s;
            }
        });
    });

    //查看商品详情
    $(function () {
        $('.seedeadei').click(function () {
            $('.xq_details').eq(0).hide();
            $('.xq_details').eq(1).show();
            $('body').animate({scrollTop: 0}, 0);
            $('.detail').find('.center').find('span').eq(1).addClass('sxp');
            $('.detail').find('.center').find('span').eq(0).removeClass('sxp');
        })
    });
    //评论
    $(function () {
        $('.tbv').click(function () {
            $('.search').children('span').eq(1).addClass('sxp').siblings().removeClass('sxp');
            $('.xq_details').eq(1).show().siblings('.xq_details').hide();
            $('.comment_de').show().siblings('.tab-con-wrapper').hide();
        })
    });

    //所选
    $(function () {
        $('.choise_num').click(function () {
            cover();
            $('#choose_spec').show();
            $('.podee').hide();
        })
        $('#choose_spec_close').click(function () {
            undercover();
            $('#choose_spec').hide();
            $('.podee').show();
        })
    });

    //加减数量
    $(function () {
        $('.mp_minous').click(function () {
            var inputs = $(this).siblings('.mp_mp').find('input');
            var val = inputs.val();
            if (val > 1) {
                val--;
                inputs.val(val);
            }else if(val == 1){
                $(this).parent().find('.mp_minous').addClass('disable');
                inputs.val(val);
            }else{
                layer.open({content:'请至少购买一份~',time: 2});
            }
        })
        $('.mp_plus').click(function () {
            var inputs = $(this).siblings('.mp_mp').find('input');
            var val = inputs.val();
            val++;
            inputs.val(val);
            if(val > 1){
                $(this).parent().find('.mp_minous').removeClass('disable');
            }
        })

        $(document).on("blur", '#goods_num', function (e) {
            initDecrement();
        })
    });
    function initDecrement(){
        var goods_num = $("input[name='goods_num']");
        var goods_num_val = parseInt(goods_num.val());
        if(goods_num_val <= 0){
            layer.open({content:'请至少购买一份~',time: 2});
            $(this).val($(this).attr('value'));
        }else if(goods_num_val == 1){
            $(this).parent().find('.mp_minous').addClass('disable');
        }else{
            $(this).parent().find('.mp_minous').removeClass('disable');
        }
    }
    //点赞
    function hde() {
        setTimeout(function () {
            $('.alert').hide();
        }, 1200)
    }

    function clickful(id) {
        var i = true;
        if ($(id).find('.btn-like-icon').hasClass('like-red')) {
            $('.alert').show(200);
            $('.alert').animate({opacity: "1"}, 600, hde());
            i = false;
        }
        if (i) {
            $(id).find('.btn-like-icon').addClass('like-red');
            $(id).find('.like').addClass('like_ani');
            var num = $(id).find('.assess-btns-num');
            var data = num.attr('data');
            data = ++data;
            num.attr('data', data);
            num.html("(" + data + ")");
        }
    }
    /**
     * 规格选择
     */
    $('.choic-sel a').click(function () {
        //切换选择
        if(!$(this).hasClass('disable')){
            $(this).addClass('red').parent().siblings().find('a').removeClass('red');
        }
        if(!$(this).hasClass('disable')){
            $(this).siblings().removeClass('hover');
            $(this).addClass('hover');
            $(this).parent().parent().find('input').removeAttr('checked');
            $(this).children('input').attr('checked', 'checked');
            $('.team-pies').hide();
            //商品价格库存显示
            dos();
            initGoodsPrice();
        }
    });
    //拼团规则
    $('.fohe i').click(function () {
        if ($(this).hasClass('action-am')) {
            $(this).removeClass('action-am');
            $('.hs_acion').animate({height: '0', opacity: 'show'}, 'normal', function () {
                $('.hs_acion').hide();
            });
        } else {
            $(this).addClass('action-am');
            $('.hs_acion').animate({height: '10.02667rem', opacity: 'show'}, 'normal', function () {
                $('.hs_acion').show();
            });
        }
    })

    // 倒计时
    setInterval(activityTime, 1000);
    function activityTime() {
        $('.rest_time').each(function(i,o){
//            $('.team-found').each(function(i,o){
//            var end_time = $(o).find('.rest_time').data('end-time');
            var end_time = $(o).data('end-time');
            var end_time_text = getOverTimeText(end_time);
//            $(o).find('.rest_time').text(end_time_text);
            $(o).text('剩余 '+end_time_text);
        })
    }
    function getOverTimeText(timeStrip){
        var end_time = parseInt(timeStrip);
        var end_time_date = formatDate(end_time*1000);
        return GetCTime(end_time_date);
    }
    //根据key值返回spec_goods_price记录
    function search_spec_goods_price(spec_key)
    {
        var spec_goods_price_item = [];
        $.each(spec_goods_price, function (i, o) {
            if (o.key == spec_key) {
                spec_goods_price_item = o;
            }
        })
        return spec_goods_price_item;
    }
    //初始化商品价格库存
    function initGoodsPrice() {
        var goods_id = $('input[name="goods_id"]').val();
        if (!$.isEmptyObject(spec_goods_price)) {
            var goods_spec_arr = [];
            $("input[name^='goods_spec']").each(function () {
                if($(this).attr('checked') == 'checked'){
                    goods_spec_arr.push($(this).val());
                }
            });
            if(goods_spec_arr.length == 0){
                return false;
            }

            var spec_key = goods_spec_arr.sort(sortNumber).join('_');  //排序后组合成 key
            var spec_goods_price_item = search_spec_goods_price(spec_key);
            var item_id = spec_goods_price_item['item_id'];
            $('input[name=item_id]').val(item_id);

        }
        var team_id =  $('input[name=team_id]').val();
        if(team_id == 0){
            $('.dis_btn').addClass('dis');
            return false;
        }
        $.ajax({
            type: 'post',
            dataType: 'json',
            data: {goods_id: goods_id,  item_id: spec_goods_price_item?spec_goods_price_item['item_id']:0},
            url: "{:U('Mobile/Team/ajaxCheckTeam')}",
            success: function (data) {
                if (data.status == 1) {
                    var goods = data.result.team_goods_item.goods;
                    var spec_goods = data.result.team_goods_item.spec_goods_price;
                    team_price = data.result.team_goods_item.team_price;
                    if(spec_goods){
                        stock = spec_goods.store_count;
                    }else{
                        stock = goods.store_count;
                    }
                    goods_activity_theme();
                    $('#item_front_status_desc').empty().html(data.result.team_goods_item.team_activity.front_status_desc);
                }else{
                    $('#item_front_status_desc').empty().html('未参与活动');
                }

            }
        });
    }
    //获取可拼单列表
    function getTeamFounds() {
        var goods_id =  $('input[name=goods_id]').val();
        $.ajax({
            type: 'post',
            dataType: 'json',
            data: {goods_id: goods_id},
            url: "{:U('Mobile/Team/ajaxTeamFound')}",
            success: function (data) {
                if (data.status == 1) {
                    var founds = data.result.teamFounds;
                    var html = '', end_time,url;
                    html += '<div class="ma-to-20 zzpd_box" >'
                    html += '    <div class="zzpd">'+founds.length+'人正在拼单，可直接参与'
                    html += '        <span class="zzpd_more">查看更多</span>'
                    html += '    </div>'
                    html += '    <ul class="zzpd_list">'
                    var str = '';
                    for(var i = 0;i < founds.length;i++){
                        end_time = parseInt(founds[i].found_time) + parseInt(founds[i].time_limit);
//                        end_time = founds[i].found_end_time;
                        console.log(end_time)

                        url = "/index.php?m=Mobile&c=Team&a=found&id=" + founds[i].found_id;
                        /*html += '<div class="box-lesc team-found"> <div class="diff_img"> <img src="'+founds[i].head_pic+'"/> ' +
                                '</div> <div class="diff_lrzy"> <ul class="f_name_add"> <li class="nameli">' +
                                '<span>'+founds[i].nickname+'</span></li> <li class="addci"><span>'+founds[i].address_region+'</span>' +
                                '</li> </ul> <ul class="f_crou_tim"> <li class="red"><span>还差<em>'+founds[i].surplus+'</em>人成团</span>' +
                                '</li> <li class="koes"><span>剩<em class="rest_time" data-end-time="'+end_time+'">00:00:00</em></span>' +
                                '</li> </ul> </div> <div class="diff_ct"> <a href="'+url+'">去参团 <i class="w-re"></i></a> </div> </div>';*/


                       html += '            <li>'
                       html += '                <img src="'+founds[i].head_pic+'" alt="__STATIC__/images/zzpd_img.png">'
                       html += '                <span class="zzpd_name">'+founds[i].nickname+'</span>'
                       html += '                <span class="zzpd_btn" onclick="go_team(this)" found_id="'+founds[i].found_id+'">去拼单</span>'
                       html += '                <p class="zzpd_num"><span>还差<i>'+(founds[i].need-founds[i].join)+'人</i>拼成</span><span class="rest_time" data-end-time="'+end_time+'">剩余23:38:03</span></p>'
                       html += '            </li>'
// class="team_end_time"
                        str += '<li>'
                        str += '    <img src="'+founds[i].head_pic+'" alt="__STATIC__/images/zzpd_img.png">'
                        str += '    <p><span>'+founds[i].nickname+'&nbsp;&nbsp;还差'+(founds[i].need-founds[i].join)+'人</span><span class="rest_time" data-end-time="'+end_time+'">剩余00:00:03</span></p>'
                        str += '    <span class="btn" onclick="go_team(this)" found_id="'+founds[i].found_id+'">去拼单</span>'
                        str += '</li>'

                    }
                    html += '    </ul>'
                    html += '</div>'
                    if(founds.length > 0){
                        //found_end_time=1553173137

                        $('.have_founds').show();
                        $('#found_list').empty().append(html);
                        $("#more-team").html(str);
                        //GetRTime2(founds[0].found_end_time)
                    }else{
                        $('.have_founds').hide();
                    }
                }
            }
        });
    }
    //商品价格库存显示
    function goods_activity_theme(){
        if(is_lottery ==1){
            $('.lottery').show();
            $('.no_lottery').hide();
            $('#lottery_a').attr('lottery_a',lottery_url);
        }else{
            $('.lottery').hide();
            $('.no_lottery').show();
        }
        $('.team_price').html(team_price);
        $('.front_status_desc').html(front_status_desc);
        $('.needer').html(needer);
        $('.stock').html(stock);
        $('.share_desc').html(share_desc);
        $('#number').attr('residuenum',stock);
        if (stock <= 0) {
            $('.dis_btn').addClass('dis');
            $('.buyNum').val(stock);
        } else {
            $('.dis_btn').removeClass('dis');
            $('.buyNum').val(1);
        }
    }
    function sortNumber(a, b) {
        return a - b;
    }
    function go_team(obj){
        var team_id = $(obj).attr('team_id');
        var found_id = $(obj).attr('found_id');
        location.href = '/index.php?m=Mobile&c=Team&a=found&id='+found_id
    }
    function GetRTime_n(end_time) {
        var NowTime = new Date();
        var t = (end_time * 1000) - NowTime.getTime();
        var d = Math.floor(t / 1000 / 60 / 60 / 24);
        var h = Math.floor(t / 1000 / 60 / 60 % 24);
        var m = Math.floor(t / 1000 / 60 % 60);
        var s = Math.floor(t / 1000 % 60);
        var get_time = new Array();
        if (t > 0) {
            var str = '';
            var h_fmort = d * 24 + h;
            get_time[0] = (h_fmort < 10) ? ('0' + h_fmort) : h_fmort;
            get_time[1] = (m < 10) ? ('0' + m) : m;
            get_time[2] = (s < 10) ? ('0' + s) : s;
            return get_time[0] + ':'+get_time[1]+':'+get_time[2];
        }
        return 0;
    }
    function GetRTime2(end_time) {

        //var end_time = $("#found_end_time").val();
        if(end_time){
            var get_time = GetRTime_n(end_time);
            if (get_time == 0) {
                $('.team_end_time').html('已结束');
            } else {
                $('.team_end_time').html('剩余:'+get_time);
                setTimeout(function(){
                    GetRTime2(end_time);
                },1000)
            }
        }
    }
    $(function(){
        //GetRTime2()
    })
</script>
<!--<script>-->
    <!--//分享-->
    <!--$(function () {-->
        <!--$('#share_button').click(function () {-->
            <!--cover();-->
            <!--$('#share_bottom').addClass('share-bottom-show');-->
        <!--})-->
        <!--$('#share_bottom_close').click(function () {-->
            <!--undercover();-->
            <!--$('#share_bottom').removeClass('share-bottom-show');-->
        <!--})-->
    <!--});-->
    <!--function setShareConfig(id,config){-->
        <!--config.bdText = share_desc;-->
        <!--config.bdDesc = share_title;-->
        <!--config.bdUrl = bd_url;-->
        <!--config.bdPic = bd_pic;-->
        <!--return config;-->
    <!--}-->
    <!--window._bd_share_config = {-->
        <!--common : {-->
            <!--//此处放置通用设置-->
            <!--onBeforeClick:setShareConfig,-->
            <!--bdText : "",-->
            <!--bdDesc : "",-->
            <!--bdUrl : "",-->
            <!--bdPic : ""-->
        <!--},-->
        <!--share : [{-->
            <!--"bdSize" : 32-->
        <!--}],-->
        <!--image : [{-->
            <!--viewType : 'list',-->
            <!--viewPos : 'top',-->
            <!--viewColor : 'black',-->
            <!--viewSize : '32',-->
            <!--viewList : ['weixin','sqq','qzone','tsina']-->
        <!--}],-->
        <!--selectShare : [{-->
            <!--"bdselectMiniList" : ['weixin','sqq','qzone','tsina']-->
        <!--}]-->
    <!--}-->
    <!--with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];-->
<!--</script>-->
</body>
</html>
